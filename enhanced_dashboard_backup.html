<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDS Risk Monitoring Dashboard</title>
    <meta name="description" content="Advanced RDS (Restructuring Difficulty Score) analysis for private equity-backed companies">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Enhanced Liquid Glass Effect - EXACT from your old code */
        .glass-panel {
            position: relative;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(2px) saturate(180%);
            border: 0.0625rem solid rgba(255, 255, 255, 0.8);
            border-radius: 2rem;
            padding: 1.25rem;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2), inset 0 4px 20px rgba(255, 255, 255, 0.3);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .glass-panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(1px);
            box-shadow: inset -10px -8px 0px -11px rgba(255, 255, 255, 1),
                inset 0px -9px 0px -8px rgba(255, 255, 255, 1);
            opacity: 0.6;
            z-index: -1;
            filter: blur(1px) drop-shadow(10px 4px 6px black) brightness(115%);
            pointer-events: none;
        }

        .glass-panel h3 {
            font-size: 1.8em;
            margin-bottom: 25px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Section Headers */
        .section-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .section-header h2 {
            font-size: 3em;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .section-header p {
            font-size: 1.3em;
            color: rgba(255, 255, 255, 0.9);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.7;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 50px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 18px 35px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 1.1em;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 30px rgba(255, 255, 255, 0.2);
        }

        /* Section Management */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Input Groups */
        .input-group {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input-group input,
        .input-group select {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 18px 25px;
            border-radius: 15px;
            flex: 1;
            min-width: 200px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .input-group select option {
            background: #333;
            color: #fff;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 18px 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 600;
            font-size: 1.1em;
            backdrop-filter: blur(20px);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 1), rgba(118, 75, 162, 1));
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            min-height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .chart-container canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .chart-container .no-data {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            margin: 0;
            padding: 40px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        /* Data Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            color: #fff;
            font-size: 0.85em;
        }

        .data-table th,
        .data-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            white-space: nowrap;
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.15);
            font-weight: 600;
            color: #fff;
            font-size: 0.9em;
            backdrop-filter: blur(20px);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.08);
            transition: background 0.3s ease;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            margin-top: 20px;
        }

        .table-container::-webkit-scrollbar {
            height: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .feature-card h4 {
            margin: 0 0 15px 0;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
        }

        /* RDS Criteria Cards - EXACT from your old code */
        .criteria-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .criteria-card {
            position: relative;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(2px) saturate(180%);
            border: 0.0625rem solid rgba(255, 255, 255, 0.8);
            border-radius: 2rem;
            padding: 1.25rem;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2), inset 0 4px 20px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .criteria-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(1px);
            box-shadow: inset -10px -8px 0px -11px rgba(255, 255, 255, 1),
                inset 0px -9px 0px -8px rgba(255, 255, 255, 1);
            opacity: 0.6;
            z-index: -1;
            filter: blur(1px) drop-shadow(10px 4px 6px black) brightness(115%);
            pointer-events: none;
        }

        .criteria-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ee5a24, #ff7675);
            border-radius: 2rem 2rem 0 0;
        }
        
        .criteria-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .criteria-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 50%;
            text-align: center;
            line-height: 50px;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .criteria-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #ffffff;
            line-height: 1.3;
        }
        
        .criteria-weight {
            display: inline-block;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(243, 156, 18, 0.3);
        }
        
        .criteria-description {
            color: #bdc3c7;
            line-height: 1.7;
            font-size: 1em;
        }

        /* Info Grid Styles */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(2px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1.5rem;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 1.5rem 1.5rem 0 0;
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(31, 38, 135, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .info-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .info-card h4 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #fff;
            font-weight: 600;
        }

        .info-card p {
            font-size: 0.95em;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
        }

        /* Capabilities Grid */
        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .capability-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(2px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.2rem;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .capability-item:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.12);
        }

        .capability-item h4 {
            font-size: 1.2em;
            margin-bottom: 12px;
            color: #fff;
            font-weight: 600;
        }

        .capability-item p {
            font-size: 0.9em;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.85);
            margin: 0;
        }

        /* Usage Steps */
        .usage-steps {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(2px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1.2rem;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .step:hover {
            transform: translateX(10px);
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.12);
        }

        .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .step-content h4 {
            font-size: 1.3em;
            margin-bottom: 8px;
            color: #fff;
            font-weight: 600;
        }

        .step-content p {
            font-size: 0.95em;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
        }

        /* Risk Level and Action Badges */
        .risk-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-badge.extreme {
            background: rgba(139, 0, 0, 0.3);
            color: #ff4444;
            border: 1px solid rgba(139, 0, 0, 0.5);
        }

        .risk-badge.critical {
            background: rgba(231, 76, 60, 0.3);
            color: #ff6b6b;
            border: 1px solid rgba(231, 76, 60, 0.5);
        }

        .risk-badge.high {
            background: rgba(230, 126, 34, 0.3);
            color: #ffa726;
            border: 1px solid rgba(230, 126, 34, 0.5);
        }

        .risk-badge.medium {
            background: rgba(241, 196, 15, 0.3);
            color: #ffd54f;
            border: 1px solid rgba(241, 196, 15, 0.5);
        }

        .risk-badge.low {
            background: rgba(46, 204, 113, 0.3);
            color: #66bb6a;
            border: 1px solid rgba(46, 204, 113, 0.5);
        }

        .risk-badge.very-low {
            background: rgba(52, 152, 219, 0.3);
            color: #42a5f5;
            border: 1px solid rgba(52, 152, 219, 0.5);
        }

        .action-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-badge.short-full {
            background: rgba(139, 0, 0, 0.3);
            color: #ff4444;
            border: 1px solid rgba(139, 0, 0, 0.5);
        }

        .action-badge.short-half {
            background: rgba(230, 126, 34, 0.3);
            color: #ffa726;
            border: 1px solid rgba(230, 126, 34, 0.5);
        }

        .action-badge.monitor-closely {
            background: rgba(241, 196, 15, 0.3);
            color: #ffd54f;
            border: 1px solid rgba(241, 196, 15, 0.5);
        }

        .action-badge.cautious {
            background: rgba(52, 152, 219, 0.3);
            color: #42a5f5;
            border: 1px solid rgba(52, 152, 219, 0.5);
        }

        .action-badge.avoid {
            background: rgba(46, 204, 113, 0.3);
            color: #66bb6a;
            border: 1px solid rgba(46, 204, 113, 0.5);
        }

        .risk-badge {
            padding: 3px 6px;
            border-radius: 8px;
            font-size: 0.7em;
            font-weight: 600;
            text-align: center;
            min-width: 30px;
            display: inline-block;
        }

        .risk-badge.critical-risk {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .risk-badge.high-risk {
            background: rgba(230, 126, 34, 0.2);
            color: #e67e22;
            border: 1px solid rgba(230, 126, 34, 0.3);
        }

        .risk-badge.medium-risk {
            background: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .risk-badge.low-risk {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .risk-badge.very-low-risk {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        /* AI Analysis Section Styling */
        .ai-analysis-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .ai-analysis-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .ai-reasoning-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }

        .ai-reasoning-list li {
            background: rgba(255, 255, 255, 0.08);
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.9);
        }

        .confidence-indicator {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 10px;
        }

        .confidence-indicator.high {
            background: rgba(231, 76, 60, 0.3);
            color: #ff6b6b;
            border: 1px solid rgba(231, 76, 60, 0.5);
        }

        .confidence-indicator.medium {
            background: rgba(241, 196, 15, 0.3);
            color: #ffd54f;
            border: 1px solid rgba(241, 196, 15, 0.5);
        }

        .confidence-indicator.low {
            background: rgba(52, 152, 219, 0.3);
            color: #42a5f5;
            border: 1px solid rgba(52, 152, 219, 0.5);
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 60px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.3em;
        }

        .error {
            text-align: center;
            padding: 30px;
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .no-data {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            font-size: 1.1em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }

            .nav-btn {
                width: 100%;
                max-width: 350px;
            }

            .input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .input-group input,
            .input-group select,
            .input-group button {
                width: 100%;
            }

            .criteria-container {
                grid-template-columns: 1fr;
            }
        }

        .unified-search-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .unified-search-container .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .unified-search-container .input-group input,
        .unified-search-container .input-group select {
            flex: 1;
            min-width: 200px;
        }

        .unified-search-container .input-group button {
            min-width: 120px;
        }

        .unified-results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .unified-results h4 {
            color: rgba(255, 255, 255, 0.9);
            margin: 0 0 20px 0;
            font-size: 1.2em;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .news-section, .sentiment-section, .peer-section, .industry-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
        }

        .news-section h5, .sentiment-section h5, .peer-section h5, .industry-section h5 {
            color: rgba(255, 255, 255, 0.8);
            margin: 0 0 15px 0;
            font-size: 1em;
        }

        .news-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .news-title {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }

        .news-summary {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.6);
        }

        .sentiment-metric, .industry-metric {
            margin-bottom: 12px;
        }

        .metric-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            margin-right: 10px;
        }

        .metric-value {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        .sentiment-factors {
            list-style: none;
            padding: 0;
            margin: 8px 0 0 0;
        }

        .sentiment-factors li {
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 10px;
            margin: 4px 0;
            border-radius: 6px;
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
        }

        .peer-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
        }

        .peer-name {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 6px;
        }

        .peer-metrics {
            display: flex;
            gap: 15px;
        }

        .peer-metrics .metric {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
        }

        .analysis-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
        }

        .analysis-content pre {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85em;
            margin: 0;
            white-space: pre-wrap;
        }

        .loading, .error, .info {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            font-weight: 500;
        }

        .loading {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .info {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .search-results {
            margin-top: 20px;
        }

        .search-results h4 {
            color: rgba(255, 255, 255, 0.9);
            margin: 0 0 20px 0;
            font-size: 1.2em;
        }

        .company-result {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .company-result:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .company-info {
            flex: 1;
        }

        .company-name {
            font-size: 1.1em;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }

        .company-details {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .company-details span {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
        }

        .company-actions {
            display: flex;
            gap: 10px;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .analysis-actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .analysis-actions .btn-primary {
            font-size: 1em;
            padding: 12px 24px;
        }

        .company-result.enhanced {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .advanced-analysis-summary {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .analysis-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }

        .analysis-label {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
            text-align: center;
        }

        .analysis-value {
            font-weight: 600;
            font-size: 1em;
            padding: 4px 8px;
            border-radius: 6px;
            text-align: center;
            min-width: 60px;
        }

        .analysis-value.positive {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .analysis-value.negative {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .analysis-value.neutral {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        .analysis-value.critical {
            background: rgba(231, 76, 60, 0.3);
            color: #ff6b6b;
        }

        .analysis-value.high {
            background: rgba(230, 126, 34, 0.3);
            color: #ffa726;
        }

        .analysis-value.medium {
            background: rgba(241, 196, 15, 0.3);
            color: #ffd54f;
        }

        .analysis-value.low {
            background: rgba(46, 204, 113, 0.3);
            color: #66bb6a;
        }

        .analysis-value.very-low {
            background: rgba(52, 152, 219, 0.3);
            color: #42a5f5;
        }

        .analysis-value.unknown {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }

        .enhanced-analysis-modal {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .enhanced-analysis-modal h3 {
            color: rgba(255, 255, 255, 0.9);
            margin: 0 0 25px 0;
            font-size: 1.5em;
            text-align: center;
        }

        .analysis-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .analysis-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .analysis-section h4 {
            color: rgba(255, 255, 255, 0.9);
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }

        .sentiment-summary, .peer-summary, .industry-summary, .lp-summary {
            margin-bottom: 15px;
        }

        .sentiment-label, .peer-label, .metric-label {
            color: rgba(255, 255, 255, 0.7);
            margin-right: 10px;
            font-size: 0.9em;
        }

        .sentiment-value, .peer-value, .metric-value {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .confidence {
            margin-left: 15px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8em;
        }

        .news-preview, .peer-companies {
            margin-top: 10px;
        }

        .news-preview-item, .peer-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 8px;
            font-size: 0.85em;
        }

        .news-title {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-bottom: 3px;
        }

        .news-date {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8em;
        }

        .peer-name {
            color: rgba(255, 255, 255, 0.9);
            margin-right: 10px;
        }

        .peer-rds {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8em;
        }

        .industry-metric, .lp-metric {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scoring-data {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            font-size: 0.8em;
            max-height: 200px;
        }

        .modal-actions {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-actions .btn-primary {
            margin-right: 10px;
        }

        /* Recommended Actions Panel Styling */
        .panel-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
            margin: 0 0 20px 0;
            font-style: italic;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.12);
        }

        .recommendation-card.critical {
            border-left-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .recommendation-card.high {
            border-left-color: #e67e22;
            background: rgba(230, 126, 34, 0.1);
        }

        .recommendation-card.medium {
            border-left-color: #f1c40f;
            background: rgba(241, 196, 15, 0.1);
        }

        .recommendation-card.low {
            border-left-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .company-name-large {
            font-size: 1.2em;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .recommendation-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .recommendation-badge.short-full {
            background: rgba(139, 0, 0, 0.3);
            color: #ff4444;
            border: 1px solid rgba(139, 0, 0, 0.5);
        }

        .recommendation-badge.short-half {
            background: rgba(230, 126, 34, 0.3);
            color: #ffa726;
            border: 1px solid rgba(230, 126, 34, 0.5);
        }

        .recommendation-badge.monitor-closely {
            background: rgba(241, 196, 15, 0.3);
            color: #ffd54f;
            border: 1px solid rgba(241, 196, 15, 0.5);
        }

        .recommendation-badge.cautious {
            background: rgba(52, 152, 219, 0.3);
            color: #42a5f5;
            border: 1px solid rgba(52, 152, 219, 0.5);
        }

        .recommendation-badge.avoid {
            background: rgba(46, 204, 113, 0.3);
            color: #66bb6a;
            border: 1px solid rgba(46, 204, 113, 0.5);
        }

        .recommendation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
        }

        .detail-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            font-size: 1em;
        }

        .recommendation-reasoning {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .reasoning-title {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .reasoning-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .reasoning-list li {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 6px;
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
            border-left: 3px solid rgba(255, 255, 255, 0.2);
        }

        .recommendation-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .urgency-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
        }

        .urgency-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .urgency-dot.critical {
            background: #e74c3c;
        }

        .urgency-dot.high {
            background: #e67e22;
        }

        .urgency-dot.medium {
            background: #f1c40f;
        }

        .urgency-dot.low {
            background: #2ecc71;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Company Details Modal Styling */
        .company-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .company-details-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .company-details-modal .btn-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .company-details-modal .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 95%;
            height: 95%;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .company-details-modal h3 {
            color: white;
            margin: 0;
        }

        .company-details-modal h4 {
            color: #667eea;
            margin: 20px 0 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
        }

        /* Full-Page Liquid Glass Modal */
        .full-page-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        .modal-content-full {
            position: relative;
            width: 95%;
            height: 95%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(31, 38, 135, 0.3), inset 0 8px 30px rgba(255, 255, 255, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header-full {
            padding: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin: 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .close-btn-full {
            background: rgba(255, 71, 87, 0.8);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .close-btn-full:hover {
            background: rgba(255, 71, 87, 1);
            transform: scale(1.1);
        }

        .modal-body-full {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .company-overview-full {
            margin-bottom: 40px;
        }

        .overview-grid-full {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .overview-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .card-value {
            font-size: 1.2rem;
            color: white;
            font-weight: 600;
        }

        .rds-score-card {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .rds-score-full {
            font-size: 2rem;
            font-weight: 700;
        }

        .rds-score-full.critical {
            color: #ff4757;
            text-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
        }

        .rds-score-full.high {
            color: #ffa502;
            text-shadow: 0 0 20px rgba(255, 165, 2, 0.5);
        }

        .rds-score-full.low {
            color: #2ecc71;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }

        .risk-badge-full, .action-badge-full {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .risk-badge-full.critical, .action-badge-full.avoid {
            background: rgba(255, 71, 87, 0.8);
            color: white;
        }

        .risk-badge-full.high, .action-badge-full.short-half {
            background: rgba(255, 165, 2, 0.8);
            color: white;
        }

        .risk-badge-full.medium, .action-badge-full.short-full {
            background: rgba(255, 193, 7, 0.8);
            color: white;
        }

        .risk-badge-full.low, .action-badge-full.monitor {
            background: rgba(46, 204, 113, 0.8);
            color: white;
        }

        .rds-breakdown-full {
            margin-top: 40px;
        }

        .section-title {
            font-size: 2rem;
            color: white;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .criteria-grid-full {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .criteria-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .criteria-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .criteria-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .criteria-score {
            font-size: 1.5rem;
            font-weight: 700;
            padding: 8px;
            border-radius: 8px;
        }

        .criteria-score.critical {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.2);
            text-shadow: 0 0 15px rgba(255, 71, 87, 0.5);
        }

        .criteria-score.high {
            color: #ffa502;
            background: rgba(255, 165, 2, 0.2);
            text-shadow: 0 0 15px rgba(255, 165, 2, 0.5);
        }

        .criteria-score.low {
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.2);
            text-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chart-container canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .no-data {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            padding: 40px;
            font-size: 1.1rem;
        }

        .no-data p {
            margin: 10px 0;
        }

        /* Sketchy PE Firms Styling */
        .sketchy-firms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .firm-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .firm-category h4 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .firm-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        .firm-item.critical {
            border-left-color: #ff4757;
        }

        .firm-item.high {
            border-left-color: #ffa502;
        }

        .firm-item.medium {
            border-left-color: #ffd32a;
        }

        .firm-item strong {
            color: white;
            display: block;
            margin-bottom: 5px;
        }

        .firm-item p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            margin: 5px 0 0 0;
        }

        .risk-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .risk-factor {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .risk-factor h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .risk-factor p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            margin: 0;
        }

        .overview-grid, .criteria-grid, .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .overview-item, .criteria-item, .metric-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .overview-item .label, .criteria-item .criteria-name, .metric-item .label {
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .overview-item .value, .criteria-item .criteria-score, .metric-item .value {
            display: block;
            color: white;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        /* Healthcare-specific styling */
        .healthcare-risks-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 182, 193, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 182, 193, 0.2);
        }
        
        .healthcare-risks-section h5 {
            color: #ffb6c1;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .criteria-item.healthcare-bonus {
            background: rgba(255, 182, 193, 0.15);
            border: 1px solid rgba(255, 182, 193, 0.3);
        }
        
        .criteria-item.healthcare-bonus .criteria-name {
            color: rgba(255, 182, 193, 0.9);
        }
        
        .criteria-item.healthcare-bonus .criteria-score {
            color: #ffb6c1;
            font-weight: 700;
        }
        
        .healthcare-note {
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 182, 193, 0.1);
            border-radius: 5px;
            border-left: 3px solid #ffb6c1;
        }
        
        .healthcare-note small {
            color: rgba(255, 182, 193, 0.8);
            font-style: italic;
        }

        .ai-insights .ai-insight {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .filings-list .filing-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filing-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .filing-type {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .filing-date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }

        .filing-ai {
            color: #f39c12;
            font-style: italic;
            margin-bottom: 15px;
        }

        .risk-factors .risk-factor {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
            padding-left: 10px;
        }

        .news-list .news-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .news-headline {
            color: white;
            font-weight: 600;
            font-size: 1.1em;
        }

        .news-date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }

        .news-summary {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .news-impact {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .impact-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }

        .impact-value {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .impact-value.high {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .impact-value.medium {
            background: rgba(230, 126, 34, 0.3);
            color: #e67e22;
        }

        .score-change {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }

        .company-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .company-link:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        /* Recent News Styling */
        .news-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .news-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .news-item.high-urgency {
            border-left: 4px solid #e74c3c;
        }

        .news-item.medium-urgency {
            border-left: 4px solid #f39c12;
        }

        .news-item.low-urgency {
            border-left: 4px solid #2ecc71;
        }

        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .news-title {
            color: white;
            font-weight: 600;
            font-size: 1.1em;
            line-height: 1.4;
            flex: 1;
            margin-right: 15px;
        }

        .news-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .news-company {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .news-date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }

        .news-summary {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .news-impact {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
        }

        .impact-details {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .impact-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }

        .impact-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .impact-badge.high {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .impact-badge.medium {
            background: rgba(230, 126, 34, 0.3);
            color: #e67e22;
        }

        .impact-badge.low {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }

        .score-change {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }

        .news-reasoning {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            margin-bottom: 10px;
            font-style: italic;
        }

        .news-metrics {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .urgency-badge, .sentiment-badge, .source-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .urgency-badge.high {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .urgency-badge.medium {
            background: rgba(230, 126, 34, 0.3);
            color: #e67e22;
        }

        .urgency-badge.low {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }

        .sentiment-badge.negative {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .sentiment-badge.neutral {
            background: rgba(149, 165, 166, 0.3);
            color: #95a5a6;
        }

        .sentiment-badge.positive {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }

        .source-badge {
            background: rgba(102, 126, 234, 0.3);
            color: #667eea;
        }
        /* Markov Chain Analysis Styles */
        .markov-analysis-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .markov-analysis-section h3 {
            color: #fff;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .markov-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .markov-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .markov-card h4 {
            color: #fff;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 0.5rem;
        }

        .state-indicator {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .state-indicator.s0_stable {
            background: #2ecc71;
            color: white;
        }

        .state-indicator.s1_elevated {
            background: #f1c40f;
            color: white;
        }

        .state-indicator.s2_high {
            background: #e67e22;
            color: white;
        }

        .state-indicator.s3_critical {
            background: #e74c3c;
            color: white;
        }

        .state-indicator.s4_default {
            background: #8e44ad;
            color: white;
        }

        .probability-grid {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .prob-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
        }

        .prob-label {
            color: #ecf0f1;
            font-weight: 500;
        }

        .prob-value {
            color: #fff;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .etd-display {
            text-align: center;
            margin-bottom: 1rem;
        }

        .etd-value {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
            display: block;
        }

        .etd-unit {
            color: #ecf0f1;
            font-size: 1rem;
        }

        .confidence-intervals {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .confidence-intervals p {
            color: #ecf0f1;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .analysis-details p {
            color: #ecf0f1;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .analysis-details strong {
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Buttons -->
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('dashboard-section')" aria-label="View main dashboard">
                Dashboard
            </button>
            <button class="nav-btn" onclick="showSection('rds-criteria-section')" aria-label="View RDS criteria information">
                RDS Criteria
            </button>
            <button class="nav-btn" onclick="showSection('company-search-section')" aria-label="Search for companies">
                Company Search
            </button>
            <button class="nav-btn" onclick="showSection('ai-analysis-section')" aria-label="Perform AI analysis">
                AI Analysis
            </button>
            <button class="nav-btn" onclick="showSection('sketchy-pe-firms-section')" aria-label="PE firms with high-risk practices">
                High-Risk PE Firms
            </button>
            </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section active">
            <div class="section-header">
                <h2>RDS Risk Monitoring Dashboard</h2>
                <p>Real-time monitoring of PE-owned private companies with AI-powered risk assessment</p>
        </div>



            <!-- Risk Distribution Chart -->
            <div class="glass-panel">
                <h3>Risk Distribution</h3>
                <div class="chart-container">
                    <canvas id="riskDistributionChart" width="400" height="300"></canvas>
            </div>
            </div>

            <!-- Monitored Companies Table -->
            <div class="glass-panel">
                <h3>Monitored Companies</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Company</th>
                                <th>RDS Score</th>
                                <th>Risk Level</th>
                                <th>Recommended Action</th>
                                <th>Est. Default Timeline</th>
                                <th>Leverage Risk</th>
                                <th>Interest Coverage</th>
                                <th>Liquidity Risk</th>
                                <th>CDS Market</th>
                                <th>Dividend Risk</th>
                                <th>Floating Debt</th>
                                <th>Rating Action</th>
                                <th>Cash Flow</th>
                                <th>Refinancing</th>
                                <th>Sponsor Profile</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="companiesTableBody">
                            <tr>
                                <td colspan="15" class="no-data">No companies monitored yet. Use the Company Search section to discover and add companies to monitoring.</td>
                            </tr>
                        </tbody>
                    </table>
            </div>
            </div>

            <!-- Recent News Section -->
            <div class="glass-panel">
                <h3>Recent News & Updates</h3>
                <div id="recentNewsContent">
                    <div class="no-data">No recent news available. Add companies to see RDS updates.</div>
            </div>
            </div>


        </div>

        <!-- System Features & Capabilities Section -->
        <div id="rds-criteria-section" class="section">
            <div class="section-header">
                <h2>Advanced RDS Analysis System - Features & Capabilities</h2>
                <p>Comprehensive showcase of all implemented features, AI capabilities, and advanced analytics</p>
                </div>
            
            <!-- What This System Does -->
            <div class="glass-panel">
                <h3>What This System Does</h3>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon">•</div>
                        <h4>Bloomberg PE Database Integration</h4>
                        <p>Leverages Bloomberg's comprehensive database of 33,000+ private equity firms and their portfolio companies. Dynamically discovers and analyzes PE-owned companies without hardcoded firm lists, providing real-time access to the entire PE ecosystem.</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">•</div>
                        <h4>AI-Powered Analysis</h4>
                        <p>Uses advanced Large Language Models (LLM) including Gemini, OpenAI, and Anthropic for contextual understanding beyond simple keyword matching. Provides nuanced, partial-point scoring with detailed reasoning.</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">•</div>
                        <h4>Bloomberg API Integration</h4>
                        <p>Primary data source is Bloomberg API for superior data quality, CDS spreads, and PE sponsorship information. No fallback data - all analysis relies on premium financial data.</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">•</div>
                        <h4>Real-Time Monitoring</h4>
                        <p>Continuous monitoring of companies with real-time news impact analysis, default timeline predictions, and tailored investment recommendations (SHORT FULL, SHORT HALF, AVOID, etc.).</p>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <h3>RDS Scoring Methodology (Total: 100 Points)</h3>
                <p style="margin-bottom: 20px; font-size: 1.1em; color: rgba(255, 255, 255, 0.9);">
                    Our Restructuring Risk Score (RDS) uses 10 carefully weighted criteria to assess the probability of default or restructuring for PE-backed companies. Each criterion is analyzed using AI-powered contextual understanding rather than simple keyword matching.
                </p>
                <div class="criteria-container">
                    <div class="criteria-card">
                        <div class="criteria-number">1</div>
                        <div class="criteria-title">Leverage Risk (Net Debt / EBITDA)</div>
                        <div class="criteria-weight">Weight: 20%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> The single strongest predictor of default. High leverage almost always precedes failure.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Pattern Recognition:</strong> EBITDA trend analysis (declining, volatile, growing patterns)</li>
                                <li><strong>Correlation Analysis:</strong> Debt structure complexity assessment</li>
                                <li><strong>Comparative Analysis:</strong> Industry benchmarking and peer comparison</li>
                                <li><strong>Volatility Assessment:</strong> Revenue stability impact on leverage risk</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 15.0 points (D/E ≥10.0x) to 2.5 points (D/E ≥2.0x)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +3.0 points for declining EBITDA trends, +2.0 points for complex debt structures, +2.0 points for 50% above industry average
                </div>
                </div>
                    
                    <div class="criteria-card">
                        <div class="criteria-number">2</div>
                        <div class="criteria-title">Interest Coverage Risk (EBITDA / Interest Expense)</div>
                        <div class="criteria-weight">Weight: 15%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> If interest isn't covered, cash burn accelerates. Especially important in today's higher-rate environment.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Predictive Analysis:</strong> Interest rate environment impact assessment</li>
                                <li><strong>Trend Analysis:</strong> EBITDA margin trajectory modeling</li>
                                <li><strong>Maturity Analysis:</strong> Debt refinancing pressure assessment</li>
                                <li><strong>Cyclical Analysis:</strong> Industry sensitivity to economic cycles</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 12.0 points (Coverage ≤0.5x) to 3.0 points (Coverage ≤3.0x)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +2.5 points for rising interest rates, +2.0 points for declining EBITDA margins, +1.5 points for near-term maturities
                </div>
                </div>

                    <div class="criteria-card">
                        <div class="criteria-number">3</div>
                        <div class="criteria-title">Liquidity Risk (Quick Ratio / Cash vs. ST Liabilities)</div>
                        <div class="criteria-weight">Weight: 10%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Illiquidity pushes companies into distressed refinancings or Chapter 11 quickly.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Working Capital Analysis:</strong> Trend detection and cash flow modeling</li>
                                <li><strong>Cash Burn Analysis:</strong> Monthly cash consumption rate assessment</li>
                                <li><strong>Seasonal Pattern Recognition:</strong> Business seasonality impact</li>
                                <li><strong>Credit Access Assessment:</strong> Market access quality evaluation</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 8.0 points (Ratio ≤0.3x) to 1.5 points (Ratio ≤1.5x)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +2.0 points for declining working capital, +2.5 points for high cash burn, +1.5 points for seasonal business
                    </div>
                    </div>
                    
                    <div class="criteria-card">
                        <div class="criteria-number">4</div>
                        <div class="criteria-title">CDS Market Pricing (5Y spread)</div>
                        <div class="criteria-weight">Weight: 10%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Forward-looking market sentiment. CDS often widens before ratings agencies act.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Trend Analysis:</strong> CDS spread trajectory and momentum assessment</li>
                                <li><strong>Volatility Analysis:</strong> Spread stability and market confidence evaluation</li>
                                <li><strong>Market Sentiment Analysis:</strong> Bearish/bullish outlook integration</li>
                                <li><strong>Sector Performance Correlation:</strong> Industry impact on individual company CDS</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 8.0 points (Spread ≥1000bps) to 1.5 points (Spread ≥50bps)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +2.0 points for widening spreads, +1.5 points for high volatility, +1.5 points for negative sentiment
                </div>
                </div>
                    
                    <div class="criteria-card">
                        <div class="criteria-number">5</div>
                        <div class="criteria-title">Special Dividend / Carried Interest Payout</div>
                        <div class="criteria-weight">Weight: 15%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Dividend recaps strip cash and often lead to defaults within 2–3 years. Strong red flag for PE-backed firms.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Behavioral Pattern Recognition:</strong> PE sponsor behavior analysis</li>
                                <li><strong>Timing Analysis:</strong> Market cycle recognition and dividend timing</li>
                                <li><strong>LP Pressure Assessment:</strong> Limited partner distribution demands</li>
                                <li><strong>Cash Flow Impact Analysis:</strong> Dividend impact on liquidity and debt service</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 12.0 points (Recent dividend recap) to 2.0 points (Conservative dividends)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +2.5 points for multiple recaps, +2.0 points for large payouts, +1.5 points for poor timing
            </div>
        </div>

                    <div class="criteria-card">
                        <div class="criteria-number">6</div>
                        <div class="criteria-title">Floating-Rate Debt Exposure</div>
                        <div class="criteria-weight">Weight: 5%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Important but secondary — amplifies problems when Fed hikes, but not always the root cause.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Hedging Analysis:</strong> Risk mitigation assessment and protection evaluation</li>
                                <li><strong>Rate Sensitivity Modeling:</strong> EBITDA impact from rate changes</li>
                                <li><strong>Fed Policy Integration:</strong> Real-time policy outlook assessment</li>
                                <li><strong>Maturity Profile Analysis:</strong> Refinancing risk from rate exposure</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 4.0 points (≥80% floating) to 1.0 points (≥20% floating)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +1.0 points for rising rates, +1.5 points for unhedged exposure, +1.0 points for hawkish Fed policy
            </div>
                    </div>
                    
                    <div class="criteria-card">
                        <div class="criteria-number">7</div>
                        <div class="criteria-title">Rating Action (last 6 months)</div>
                        <div class="criteria-weight">Weight: 5%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Useful but lagging — agencies usually move after CDS and fundamentals already show stress.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Agency Consensus Analysis:</strong> Multi-agency coordination assessment</li>
                                <li><strong>Momentum Modeling:</strong> Rating trajectory pattern recognition</li>
                                <li><strong>Sector Trend Analysis:</strong> Industry context integration</li>
                                <li><strong>Horizon Analysis:</strong> Timeline for rating changes</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 4.0 points (multiple downgrades) to 1.5 points (minor downgrades)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +2.0 points for negative outlook, +1.5 points for all agencies negative, +1.5 points for accelerating downgrades
            </div>
        </div>

                    <div class="criteria-card">
                        <div class="criteria-number">8</div>
                        <div class="criteria-title">Cash Flow Coverage (FCF / Debt service)</div>
                        <div class="criteria-weight">Weight: 10%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Directly measures sustainability — negative FCF coverage kills flexibility.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Volatility Assessment:</strong> FCF stability analysis and trend modeling</li>
                                <li><strong>Quality Analysis:</strong> Revenue quality and working capital impact</li>
                                <li><strong>Seasonal Analysis:</strong> Cash flow pattern recognition</li>
                                <li><strong>Capex Analysis:</strong> Investment requirements assessment</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 8.0 points (FCF coverage <0) to 1.5 points (FCF coverage <0.25)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +2.0 points for high FCF volatility, +2.0 points for declining FCF, +1.5 points for working capital draining cash
                    </div>
                    </div>
                    
                    <div class="criteria-card">
                        <div class="criteria-number">9</div>
                        <div class="criteria-title">Refinancing Pressure (<18 months maturity wall)</div>
                        <div class="criteria-weight">Weight: 5%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Critical when markets are shut, but less predictive if refi windows are open.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Market Access Analysis:</strong> Credit market availability assessment</li>
                                <li><strong>Debt Size Analysis:</strong> Refinancing complexity evaluation</li>
                                <li><strong>Covenant Analysis:</strong> Refinancing restriction assessment</li>
                                <li><strong>Industry Outlook Analysis:</strong> Sector context integration</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 4.0 points (≤6 months) to 1.0 points (≤24 months)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +1.5 points for challenging markets, +1.5 points for restricted access, +1.0 points for large debt refinancing
                    </div>
                </div>

                    <div class="criteria-card">
                        <div class="criteria-number">10</div>
                        <div class="criteria-title">Sponsor Profile (aggressive recaps, fast exits)</div>
                        <div class="criteria-weight">Weight: 5%</div>
                        <div class="criteria-description">
                            <strong>Purpose:</strong> Adds context — sponsors with a history of cash-outs are higher risk.
                            <br><br>
                            <strong>AI-Powered Analysis:</strong>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>Behavioral Pattern Recognition:</strong> PE sponsor behavior analysis</li>
                                <li><strong>Reputation Analysis:</strong> PE firm standing assessment</li>
                                <li><strong>Track Record Analysis:</strong> Historical performance evaluation</li>
                                <li><strong>LP Relationship Analysis:</strong> Capital provider pressure assessment</li>
                            </ul>
                            <br>
                            <strong>Base Scoring:</strong> 2.0 points (aggressive behavior) to -0.5 points (conservative)
                            <br>
                            <strong>AI Enhancement Factors:</strong> +1.5 points for multiple recaps, +2.0 points for distressed exits, +2.0 points for poor track record
                    </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- System Capabilities Removed -->

            <!-- How to Use Section Removed -->

        <!-- Company Search Section -->
        <div id="company-search-section" class="section">
            <div class="section-header">
                <h2>Company Search & Discovery</h2>
                <p>Search for PE-owned private companies with customizable industry and company count filters</p>
            </div>

            <div class="glass-panel">
                <h3>Company Discovery</h3>
                <div class="input-group">
                    <select id="industrySelect">
                        <option value="">Select Industry</option>
                        <option value="retail">Retail/Consumer</option>
                        <option value="energy">Energy (Oil & Gas, Renewables)</option>
                        <option value="media">Media/Entertainment</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="transportation">Transportation</option>
                        <option value="technology">Technology</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="real_estate">Real Estate</option>
                        <option value="financial">Financial Services</option>
                        <option value="other">Other</option>
                    </select>
                    <input type="number" id="companyCountInput" placeholder="Number of companies to search" min="1" max="100" value="10" />
                    <button onclick="searchCompanies()" class="btn-primary">Search Companies</button>
        </div>

                <div id="searchResults">
                    <div class="no-data">Select industry and company count above to search for PE-owned companies.</div>
            </div>
        </div>
        </div>

            <!-- Advanced Markov Chain Features -->
            <div class="glass-panel">
                <h3>Markov Chain Default Probability Engine</h3>
                <p style="margin-bottom: 20px; font-size: 1.1em; color: rgba(255, 255, 255, 0.9);">
                    Advanced probabilistic modeling using Markov chain methodology to forecast default probabilities with state-based risk transitions and multi-horizon forecasting capabilities.
                </p>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon">🎯</div>
                        <h4>State-Based Risk Modeling</h4>
                        <p>Five-state Markov chain system: S0 (Stable, RDS < 50), S1 (Elevated, 50-75), S2 (High Risk, 75-90), S3 (Critical, ≥90), S4 (Default, absorbing state)</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">📈</div>
                        <h4>Multi-Horizon Forecasting</h4>
                        <p>Calculates default probabilities at 6, 12, and 24 months with expected time to default and confidence intervals using Monte Carlo validation (10,000 runs)</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">🏦</div>
                        <h4>Bloomberg Integration</h4>
                        <p>Uses Bloomberg historical migration data with Moody's/S&P fallback, applies post-LBO adjustments (+2.5%) and sector-specific risk premiums</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">⚡</div>
                        <h4>Real-Time Analysis</h4>
                        <p>Automatically runs Markov analysis for each company, displaying probabilities in company details modal with beautiful visualizations and confidence intervals</p>
                    </div>
                </div>
            </div>

            <!-- Advanced System Features -->
            <div class="glass-panel">
                <h3>Advanced System Features & Capabilities</h3>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-icon">🤖</div>
                        <h4>Enhanced LLM Analyzer</h4>
                        <p>Multi-model AI integration (OpenAI, Anthropic, Google Gemini) with consensus scoring, context-aware risk detection, and real-time news sentiment analysis</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">📊</div>
                        <h4>Enhanced RDS Calculator</h4>
                        <p>Sophisticated 10-dimensional risk scoring with dynamic weighting, sector-specific adjustments, and AI-powered pattern recognition</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">📄</div>
                        <h4>SEC Filing Analyzer</h4>
                        <p>Automated document processing extracting risk factors, financial metrics, and management insights from 10-K/10-Q filings</p>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">🎨</div>
                        <h4>Professional Dashboard</h4>
                        <p>Modern liquid glass UI with interactive charts, real-time monitoring, full-page company details modals, and responsive design</p>
                    </div>
            </div>
        </div>
    </div>

        <!-- AI Analysis Section -->
        <div id="ai-analysis-section" class="section">
            <div class="section-header">
                <h2>AI-Powered Risk Analysis</h2>
                <p>Advanced artificial intelligence analysis with contextual understanding</p>
        </div>

            <div class="glass-panel">
                <h3>Perform AI Analysis</h3>
                <div class="input-group">
                    <input type="text" id="aiCompanyInput" placeholder="Enter company name for AI analysis">
                    <button onclick="performAIAnalysis()" class="btn-primary">Analyze with AI</button>
                </div>
                <div id="aiAnalysisResults"></div>
        </div>
    </div>


    </div>

    <script>
        // Section Navigation
        function showSection(sectionName) {
            console.log('Showing section:', sectionName);
            
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
                console.log('Section shown:', sectionName);
            } else {
                console.error('Section not found:', sectionName);
            }
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Initialize empty risk chart
        function initRiskChart() {
            const ctx = document.getElementById('riskDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical Risk', 'High Risk', 'Medium Risk', 'Low Risk'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#e74c3c', '#e67e22', '#f1c40f', '#2ecc71'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#fff',
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
            
            // Add centered message when no companies
            const chartContainer = document.getElementById('riskDistributionChart').parentElement;
            if (chartContainer) {
                // Hide the canvas temporarily
                const canvas = chartContainer.querySelector('canvas');
                if (canvas) {
                    canvas.style.display = 'none';
                }
                
                // Add the centered message with proper styling
                const messageDiv = document.createElement('div');
                messageDiv.className = 'no-data';
                messageDiv.innerHTML = 'No companies monitored yet.<br>Add companies to see risk distribution.';
                chartContainer.appendChild(messageDiv);
            }
        }

        // Utility Functions for RDS Analysis
        function getRiskLevel(score) {
            if (score >= 80) return 'EXTREME';
            if (score >= 70) return 'CRITICAL';
            if (score >= 60) return 'HIGH';
            if (score >= 40) return 'MEDIUM';
            if (score >= 20) return 'LOW';
            return 'VERY LOW';
        }

        // Get risk level class for individual criteria styling
        function getRiskLevelClass(score) {
            if (score >= 8) return 'critical-risk';
            if (score >= 6) return 'high-risk';
            if (score >= 4) return 'medium-risk';
            if (score >= 2) return 'low-risk';
            return 'very-low-risk';
        }

        // AI-Powered Recommended Action System
        function getAIRecommendedAction(companyData) {
            // This would integrate with Bloomberg API and AI analysis
            // For now, showing the enhanced logic structure
            
            const {
                rdsScore = 0,
                industry = 'unknown',
                leverageRatio = 0,
                interestCoverage = 0,
                liquidityRatio = 0,
                cdsSpread = 0,
                peSponsor = 'unknown',
                recentEvents = [],
                marketConditions = 'stable'
            } = companyData;

            let action = '';
            let confidence = '';
            let reasoning = [];
            let urgency = '';

            // AI Analysis: Leverage Risk Assessment
            if (leverageRatio > 8) {
                reasoning.push('Extreme leverage (>8x EBITDA)');
                urgency = 'HIGH';
            } else if (leverageRatio > 6) {
                reasoning.push('High leverage (>6x EBITDA)');
                urgency = 'MEDIUM';
            }

            // AI Analysis: Interest Coverage Crisis
            if (interestCoverage < 1.0) {
                reasoning.push('Interest coverage below 1.0x - cash burn imminent');
                urgency = 'CRITICAL';
            } else if (interestCoverage < 1.5) {
                reasoning.push('Weak interest coverage (<1.5x)');
                urgency = 'HIGH';
            }

            // AI Analysis: Liquidity Crisis
            if (liquidityRatio < 0.5) {
                reasoning.push('Critical liquidity risk (<0.5x)');
                urgency = 'CRITICAL';
            } else if (liquidityRatio < 1.0) {
                reasoning.push('Poor liquidity (<1.0x)');
                urgency = 'HIGH';
            }

            // AI Analysis: CDS Market Sentiment
            if (cdsSpread > 1000) {
                reasoning.push('CDS >1000bps - market expects default');
                urgency = 'CRITICAL';
            } else if (cdsSpread > 500) {
                reasoning.push('CDS >500bps - high default probability');
                urgency = 'HIGH';
            }

            // AI Analysis: PE Sponsor Behavior
            if (peSponsor === 'aggressive') {
                reasoning.push('Aggressive PE sponsor - likely dividend recaps');
                urgency = urgency === 'CRITICAL' ? 'CRITICAL' : 'HIGH';
            }

            // AI Analysis: Industry Context
            if (industry === 'retail' && leverageRatio > 5) {
                reasoning.push('Retail sector with high leverage - sector distress');
                urgency = urgency === 'CRITICAL' ? 'CRITICAL' : 'HIGH';
            }

            // AI Analysis: Market Conditions
            if (marketConditions === 'stress' && rdsScore > 50) {
                reasoning.push('Market stress amplifies existing risks');
                urgency = urgency === 'CRITICAL' ? 'CRITICAL' : 'HIGH';
            }

            // AI Decision Logic
            if (urgency === 'CRITICAL' || rdsScore >= 80) {
                action = 'SHORT FULL';
                confidence = 'HIGH';
                reasoning.push('Multiple critical risk factors align');
            } else if (urgency === 'HIGH' || rdsScore >= 60) {
                action = 'SHORT HALF';
                confidence = 'MEDIUM';
                reasoning.push('Significant risk factors present');
            } else if (rdsScore >= 40) {
                action = 'MONITOR CLOSELY';
                confidence = 'MEDIUM';
                reasoning.push('Elevated risk - watch for deterioration');
            } else if (rdsScore >= 20) {
                action = 'CAUTIOUS';
                confidence = 'LOW';
                reasoning.push('Moderate risk - limited upside');
            } else {
                action = 'AVOID';
                confidence = 'LOW';
                reasoning.push('Low risk but limited opportunity');
            }

            return {
                action: action,
                confidence: confidence,
                urgency: urgency,
                reasoning: reasoning,
                aiAnalysis: true
            };
        }

        // Enhanced Company Analysis with AI Recommendations
        function analyzeCompanyWithAI(companyName, rdsScore = 0) {
            // Simulate AI analysis - in real implementation, this would call Bloomberg API
            const mockCompanyData = {
                rdsScore: rdsScore,
                industry: 'Technology',
                leverageRatio: rdsScore > 70 ? 8.5 : rdsScore > 50 ? 6.2 : 3.1,
                interestCoverage: rdsScore > 70 ? 0.8 : rdsScore > 50 ? 1.2 : 2.5,
                liquidityRatio: rdsScore > 70 ? 0.4 : rdsScore > 50 ? 0.8 : 1.5,
                cdsSpread: rdsScore > 70 ? 1200 : rdsScore > 50 ? 600 : 150,
                peSponsor: rdsScore > 60 ? 'aggressive' : 'conservative',
                recentEvents: rdsScore > 60 ? ['Recent dividend recap', 'Covenant breach'] : [],
                marketConditions: 'stable'
            };

            const aiRecommendation = getAIRecommendedAction(mockCompanyData);
            
            return {
                companyName: companyName,
                rdsScore: rdsScore,
                riskLevel: getRiskLevel(rdsScore),
                aiRecommendation: aiRecommendation,
                financialMetrics: mockCompanyData,
                analysisTimestamp: new Date().toISOString()
            };
        }

        // Perform AI Analysis
        function performAIAnalysis() {
            const companyName = document.getElementById('aiCompanyInput').value.trim();
            const rdsScore = parseInt(document.getElementById('aiRdsScoreInput').value) || 0;
            
            if (!companyName) {
                alert('Please enter a company name');
                return;
            }
            
            if (rdsScore < 0 || rdsScore > 100) {
                alert('Please enter a valid RDS score (0-100)');
                return;
            }

            const resultsDiv = document.getElementById('aiAnalysisResults');
            resultsDiv.innerHTML = '<div class="loading">Performing AI-powered analysis...</div>';

            // Simulate AI analysis
            setTimeout(() => {
                const analysis = analyzeCompanyWithAI(companyName, rdsScore);
                displayAIAnalysis(analysis);
            }, 1500);
        }

        // Display AI Analysis Results
        function displayAIAnalysis(analysis) {
            const resultsDiv = document.getElementById('aiAnalysisResults');
            
            resultsDiv.innerHTML = `
                <div class="ai-analysis-card">
                    <h4 style="margin-bottom: 20px; color: #fff; font-size: 1.3em;">
                        AI Analysis for ${analysis.companyName}
                    </h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="background: rgba(255,255,255,0.08); padding: 20px; border-radius: 15px; backdrop-filter: blur(20px);">
                            <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">RDS Score</div>
                            <div style="font-size: 1.6em; font-weight: bold; color: #e74c3c;">${analysis.rdsScore}/100</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.08); padding: 20px; border-radius: 15px; backdrop-filter: blur(20px);">
                            <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">Risk Level</div>
                            <div style="font-size: 1.6em; font-weight: bold;">${analysis.riskLevel}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.08); padding: 20px; border-radius: 15px; backdrop-filter: blur(20px);">
                            <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">AI Recommendation</div>
                            <div style="font-size: 1.6em; font-weight: bold;">
                                <span class="action-badge ${analysis.aiRecommendation.action.toLowerCase().replace(' ', '-')}">${analysis.aiRecommendation.action}</span>
                                <span class="confidence-indicator ${analysis.aiRecommendation.confidence}">${analysis.aiRecommendation.confidence}</span>
                        </div>
                        </div>
                        </div>
                    
                    <div style="background: rgba(255,255,255,0.08); padding: 25px; border-radius: 15px; backdrop-filter: blur(20px); margin-bottom: 20px;">
                        <h5 style="margin-bottom: 15px; color: #fff;">AI Reasoning & Analysis</h5>
                        <ul class="ai-reasoning-list">
                            ${analysis.aiRecommendation.reasoning.map(reason => `<li>${reason}</li>`).join('')}
                        </ul>
                        </div>
                    
                    <div style="background: rgba(255,255,255,0.08); padding: 25px; border-radius: 15px; backdrop-filter: blur(20px);">
                        <h5 style="margin-bottom: 15px; color: #fff;">Financial Metrics Analysis</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">Leverage Ratio</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: ${analysis.financialMetrics.leverageRatio > 6 ? '#ff6b6b' : '#66bb6a'};">${analysis.financialMetrics.leverageRatio}x</div>
                        </div>
                            <div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">Interest Coverage</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: ${analysis.financialMetrics.interestCoverage < 1.5 ? '#ff6b6b' : '#66bb6a'};">${analysis.financialMetrics.interestCoverage}x</div>
                        </div>
                            <div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">Liquidity Ratio</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: ${analysis.financialMetrics.liquidityRatio < 1.0 ? '#ff6b6b' : '#66bb6a'};">${analysis.financialMetrics.liquidityRatio}x</div>
                    </div>
                            <div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">CDS Spread</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: ${analysis.financialMetrics.cdsSpread > 500 ? '#ff6b6b' : '#66bb6a'};">${analysis.financialMetrics.cdsSpread}bps</div>
                </div>
                    </div>
                </div>
                
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: center;">
                        <small style="color: rgba(255,255,255,0.6);">
                            Analysis performed at: ${new Date(analysis.analysisTimestamp).toLocaleString()}
                        </small>
                </div>
                </div>
            `;
        }

        function getRecommendedAction(score) {
            // Fallback to simple scoring if no company data available
            if (score >= 80) return 'SHORT FULL';
            if (score >= 70) return 'SHORT FULL';
            if (score >= 60) return 'SHORT HALF';
            if (score >= 40) return 'MONITOR CLOSELY';
            if (score >= 20) return 'CAUTIOUS';
            return 'AVOID';
        }

        function estimateDefaultTimeline(score) {
            if (score >= 80) return '< 3 months';
            if (score >= 70) return '3-6 months';
            if (score >= 60) return '6-12 months';
            if (score >= 40) return '1-2 years';
            if (score >= 20) return '2-5 years';
            return '> 5 years';
        }

        // Removed duplicate function - using the one below

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing dashboard...');
            
            // Test if functions exist
            console.log('loadDashboardData function exists:', typeof loadDashboardData);
            console.log('updateRiskChartWithCompanies function exists:', typeof updateRiskChartWithCompanies);
            console.log('displayRecentNews function exists:', typeof displayRecentNews);
            
            // Test if elements exist
            console.log('recentNewsContent element exists:', document.getElementById('recentNewsContent'));
            console.log('riskDistributionChart element exists:', document.getElementById('riskDistributionChart'));
            
            // Load initial data from real API
            loadDashboardData();
        });

        // Global variables
        let monitored_companies = [];

        // Real API Integration Functions
        async function loadDashboardData() {
            try {
                console.log('loadDashboardData: Starting...');
                const response = await fetch('/api/dashboard-data');
                const data = await response.json();
                
                console.log('loadDashboardData: API response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                monitored_companies = data.companies || [];
                console.log('loadDashboardData: Companies loaded:', monitored_companies);
                
                // Update companies table
                console.log('loadDashboardData: Updating companies table...');
                displayCompanies(monitored_companies);
                
                // Update risk distribution chart
                console.log('loadDashboardData: Updating risk chart...');
                updateRiskChartWithCompanies(monitored_companies);
                
                // Update recent news
                console.log('loadDashboardData: Loading recent news...');
                loadRecentNews();
                
                // Update recommended actions panel
                console.log('loadDashboardData: Updating recommended actions...');
                displayRecommendedActions(monitored_companies);
                
                console.log('loadDashboardData: Completed successfully');
                
            } catch (error) {
                console.error('Dashboard data error:', error);
                document.getElementById('dashboard-content').innerHTML = `
                    <div class="error">
                        Error loading dashboard data: ${error.message}
                </div>
                `;
            }
        }

        // Function to update risk distribution chart with company data
        function updateRiskChartWithCompanies(companies) {
            console.log('updateRiskChartWithCompanies: Called with companies:', companies);
            
            if (!companies || companies.length === 0) {
                console.log('updateRiskChartWithCompanies: No companies, showing empty state');
                // Show empty state
                const chartContainer = document.getElementById('riskDistributionChart');
                if (chartContainer) {
                    chartContainer.style.display = 'none';
                    const container = chartContainer.parentElement;
                    container.innerHTML = `
                        <div class="no-data">
                            <p>No companies monitored yet.</p>
                            <p>Add companies to see risk distribution.</p>
                        </div>
                    `;
                }
                return;
            }
            
            // Force a small delay to ensure DOM is ready
            setTimeout(() => {
                console.log('updateRiskChartWithCompanies: Starting chart update after delay');
                updateRiskChartWithCompaniesImmediate(companies);
            }, 100);
        }
        
        // Immediate chart update function
        function updateRiskChartWithCompaniesImmediate(companies) {
            console.log('updateRiskChartWithCompaniesImmediate: Starting with companies:', companies);

            // Restore the canvas if it was hidden
            const chartContainer = document.getElementById('riskDistributionChart');
            console.log('Chart container found:', chartContainer);
            
            if (chartContainer) {
                chartContainer.style.display = 'block';
                // Restore the original canvas if it was replaced
                if (!chartContainer.querySelector('canvas')) {
                    const container = chartContainer.parentElement;
                    container.innerHTML = `
                        <div class="chart-container">
                            <canvas id="riskDistributionChart" width="400" height="300"></canvas>
                        </div>
                    `;
                    console.log('Canvas restored in container');
                }
            } else {
                // If the chart container doesn't exist, recreate it
                const riskSection = document.querySelector('.glass-panel h3');
                if (riskSection && riskSection.textContent.includes('Risk Distribution')) {
                    const panel = riskSection.closest('.glass-panel');
                    if (panel) {
                        const existingChartContainer = panel.querySelector('.chart-container');
                        if (existingChartContainer) {
                            existingChartContainer.innerHTML = '<canvas id="riskDistributionChart" width="400" height="300"></canvas>';
                            console.log('Canvas recreated in existing container');
                        }
                    }
                }
            }

            // Calculate risk distribution
            const riskDistribution = [0, 0, 0, 0]; // Low, Medium, High, Critical
            companies.forEach(company => {
                const score = company.current_rds_score || company.rds_score || 0;
                console.log(`Company ${company.name}: score ${score}`);
                if (score < 20) {
                    riskDistribution[0] += 1; // Low
                } else if (score < 40) {
                    riskDistribution[1] += 1; // Medium
                } else if (score < 70) {
                    riskDistribution[2] += 1; // High
                } else {
                    riskDistribution[3] += 1; // Critical
                }
            });

            console.log('updateRiskChartWithCompaniesImmediate: Risk distribution calculated:', riskDistribution);
            
            // Update the chart
            updateRiskChart(riskDistribution);
            
            // Force a small delay to ensure DOM is updated
            setTimeout(() => {
                console.log('Chart update completed');
            }, 100);
        }

        // Function to update the risk distribution chart
        function updateRiskChart(riskDistribution) {
            console.log('updateRiskChart called with data:', riskDistribution);
            
            let ctx = document.getElementById('riskDistributionChart');
            console.log('Canvas element found:', ctx);
            
            if (!ctx) {
                // Try to find the canvas element
                const canvas = document.querySelector('#riskDistributionChart');
                console.log('Canvas querySelector result:', canvas);
                if (canvas) {
                    ctx = canvas.getContext('2d');
                    console.log('Canvas context created:', ctx);
                } else {
                    console.error('Risk distribution chart canvas not found');
                    return;
                }
            } else {
                ctx = ctx.getContext('2d');
                console.log('Canvas context created from getElementById:', ctx);
            }

            // Destroy existing chart if it exists
            if (window.riskChart) {
                window.riskChart.destroy();
            }

            // Create new chart
            console.log('Creating new Chart with context:', ctx, 'and data:', riskDistribution);
            window.riskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk (0-19)', 'Medium Risk (20-39)', 'High Risk (40-69)', 'Critical Risk (70-100)'],
                    datasets: [{
                        data: riskDistribution,
                        backgroundColor: [
                            '#2ecc71', // Green for low risk
                            '#f1c40f', // Yellow for medium risk
                            '#e67e22', // Orange for high risk
                            '#e74c3c'  // Red for critical risk
                        ],
                        borderColor: [
                            '#27ae60',
                            '#f39c12',
                            '#d35400',
                            '#c0392b'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }
                    }
                }
            });
            
            console.log('Chart created successfully:', window.riskChart);
        }
        
        // Test function to manually create a chart
        function testChart() {
            console.log('Testing chart creation...');
            const testData = [0, 0, 0, 3]; // All 3 companies in critical risk
            updateRiskChart(testData);
        }

        async function addCompany() {
            const companyInput = document.getElementById('addCompanyInput');
            const companyName = companyInput.value.trim();
            
            if (!companyName) {
                alert('Please enter a company name');
                return;
            }

            try {
                const response = await fetch('/api/analyze-company', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ company_name: companyName })
                });

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                alert(`Company ${companyName} analyzed successfully! RDS Score: ${result.company.rds_score}`);
                companyInput.value = '';
                
                // Reload dashboard data
                loadDashboardData();
                
            } catch (error) {
                console.error('Add company error:', error);
                alert(`Error analyzing company: ${error.message}`);
            }
        }

        async function searchCompanies() {
            const industry = document.getElementById('industrySelect').value;
            const companyCount = document.getElementById('companyCountInput').value;
            
            if (!industry) {
                alert('Please select an industry');
                return;
            }

            if (!companyCount || companyCount < 1 || companyCount > 100) {
                alert('Please enter a valid company count (1-100)');
                return;
            }

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div class="loading">Discovering companies with advanced Bloomberg API analysis...</div>';

            try {
                const response = await fetch('/api/discover-companies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        industry: industry, 
                        company_count: parseInt(companyCount) 
                    })
                });

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                // Automatically perform advanced analysis on each company
                await displayEnhancedSearchResults(result.companies, industry);
                
            } catch (error) {
                console.error('Search error:', error);
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        async function displayEnhancedSearchResults(companies, industry) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (!companies || companies.length === 0) {
                resultsDiv.innerHTML = '<div class="no-data">No companies found for the selected criteria.</div>';
                return;
            }

            let html = '<div class="search-results">';
            html += `<h4>Discovered Companies in ${industry} with Advanced Bloomberg API Analysis</h4>`;
            
            // Process each company with advanced analysis
            for (const company of companies) {
                const companyName = typeof company === 'string' ? company : (company.name || company.ticker);
                
                // Fetch advanced Bloomberg API data for each company
                const [newsData, sentimentData, peerData, industryData] = await Promise.allSettled([
                    fetch(`/api/company-news/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/market-sentiment/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/peer-analysis/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/industry-stats/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null)
                ]);

                html += `
                    <div class="company-result enhanced">
                        <div class="company-info">
                            <div class="company-name">${companyName}</div>
                            <div class="company-details">
                                <span class="sector">${company.sector || 'Unknown'}</span>
                                <span class="market-cap">Market Cap: $${(company.market_cap || 0).toLocaleString()}</span>
                                <span class="leverage">Leverage: ${company.debt_to_ebitda ? company.debt_to_ebitda.toFixed(2) + 'x' : 'N/A'}</span>
                            </div>
                        </div>
                        
                        <div class="advanced-analysis-summary">
                            <div class="analysis-item">
                                <span class="analysis-label">News Sentiment:</span>
                                <span class="analysis-value ${getSentimentClass(sentimentData.value?.sentiment)}">${sentimentData.value?.sentiment || 'N/A'}</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">Peer Risk:</span>
                                <span class="analysis-value ${getRiskClass(peerData.value?.avg_rds_score)}">${peerData.value?.avg_rds_score ? Math.round(peerData.value.avg_rds_score) : 'N/A'}</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">Industry Default:</span>
                                <span class="analysis-value ${getRiskClass(industryData.value?.default_rate)}">${industryData.value?.default_rate ? industryData.value.default_rate + '%' : 'N/A'}</span>
                            </div>
                        </div>
                        
                        <div class="company-actions">
                            <button onclick="addCompanyToMonitor('${companyName}')" class="btn-primary">Add to Monitor</button>
                            <button onclick="viewEnhancedCompanyDetails('${companyName}')" class="btn-secondary">View Full Analysis</button>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        function displaySearchResults(companies, industry) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (!companies || companies.length === 0) {
                resultsDiv.innerHTML = '<div class="no-data">No companies found for the selected criteria.</span>';
                return;
            }

            let html = '<div class="search-results">';
            html += `<h4>Discovered Companies in ${industry}</h4>`;
            
            companies.forEach(company => {
                const companyName = typeof company === 'string' ? company : (company.name || company.ticker);
                html += `
                    <div class="company-result">
                        <div class="company-info">
                            <div class="company-name">${companyName}</div>
                            <div class="company-details">
                                <span class="sector">${company.sector || 'Unknown'}</span>
                                <span class="market-cap">Market Cap: $${(company.market_cap || 0).toLocaleString()}</span>
                                <span class="leverage">Leverage: ${company.debt_to_ebitda ? company.debt_to_ebitda.toFixed(2) + 'x' : 'N/A'}</span>
                            </div>
                        </div>
                        <div class="company-actions">
                            <button onclick="addCompanyToMonitor('${companyName}')" class="btn-primary">Add to Monitor</button>
                            <button onclick="viewCompanyDetails('${companyName}')" class="btn-secondary">View Details</button>
                    </div>
                </div>
            `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        async function analyzeDiscoveredCompany(companyName) {
            try {
                const response = await fetch('/api/analyze-company', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ company_name: companyName })
                });

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                alert(`${companyName} analyzed successfully! RDS Score: ${result.company.rds_score}`);
                
                // Reload dashboard data
                loadDashboardData();
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert(`Error analyzing ${companyName}: ${error.message}`);
            }
        }

        async function loadRecentNews() {
            try {
                console.log('Loading recent news...');
                const response = await fetch('/api/recent-news');
                const data = await response.json();
                
                console.log('Recent news response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                console.log('Displaying news items:', data.news);
                displayRecentNews(data.news || []);
                
            } catch (error) {
                console.error('Recent news error:', error);
                document.getElementById('recentNewsContent').innerHTML = `
                    <div class="error">Error loading recent news: ${error.message}</div>
                `;
            }
        }

        function displayRecentNews(newsItems) {
            console.log('displayRecentNews called with:', newsItems);
            const contentDiv = document.getElementById('recentNewsContent');
            console.log('Found contentDiv:', contentDiv);
            
            if (!newsItems || newsItems.length === 0) {
                console.log('No news items, showing no-data message');
                contentDiv.innerHTML = '<div class="no-data">No recent news available. Add companies to see RDS updates.</div>';
                return;
            }

            let html = '';
            newsItems.forEach(news => {
                const urgencyClass = news.urgency ? news.urgency.toLowerCase() : 'medium';
                const impactClass = news.rds_impact ? news.rds_impact.toLowerCase() : 'medium';
                
                html += `
                    <div class="news-item ${urgencyClass}-urgency">
                        <div class="news-header">
                            <div class="news-title">${news.headline}</div>
                            <div class="news-meta">
                                <span class="news-company">${news.company}</span>
                                <span class="news-date">${new Date(news.timestamp).toLocaleDateString()}</span>
                    </div>
                    </div>
                        
                        <div class="news-summary">${news.summary}</div>
                        
                        <div class="news-impact">
                            <div class="impact-details">
                                <span class="impact-label">RDS Impact:</span>
                                <span class="impact-badge ${impactClass}">${news.rds_impact}</span>
                                <span class="score-change">Score Change: ${news.score_change > 0 ? '+' : ''}${news.score_change}</span>
                            </div>
                            
                            <div class="news-reasoning">
                                <strong>AI Analysis:</strong> ${news.reasoning}
                            </div>
                            
                            <div class="news-metrics">
                                <span class="urgency-badge ${urgencyClass}">${news.urgency} Urgency</span>
                                <span class="sentiment-badge ${news.sentiment}">${news.sentiment}</span>
                                <span class="source-badge">${news.source}</span>
                            </div>
                        </div>
                </div>
            `;
            });

            contentDiv.innerHTML = html;
        }

        function displayCompanies(companies) {
            const tbody = document.getElementById('companiesTableBody');
            
            if (!companies || companies.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="15" class="no-data">No companies monitored yet. Use the Company Search section to discover and add companies to monitoring.</td>
                    </tr>
                `;
                return;
            }

            let html = '';
            companies.forEach(company => {
                const riskClass = getRdsScoreClass(company.current_rds_score);
                html += `
                    <tr>
                        <td><a href="#" onclick="viewCompanyDetails('${company.name}')" class="company-link">${company.name}</a></td>
                        <td><span class="rds-score ${riskClass}">${company.current_rds_score}</span></td>
                        <td><span class="risk-badge ${company.risk_level.toLowerCase().replace(' ', '-')}">${company.risk_level}</span></td>
                        <td><span class="action-badge ${company.recommended_action.toLowerCase().replace(' ', '-')}">${company.recommended_action}</span></td>
                        <td>${company.default_timeline}</td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.leverage_risk || 0)}">${company.leverage_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.interest_coverage_risk || 0)}">${company.interest_coverage_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.liquidity_risk || 0)}">${company.liquidity_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.cds_market_risk || 0)}">${company.cds_market_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.dividend_risk || 0)}">${company.dividend_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.floating_debt_risk || 0)}">${company.floating_debt_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.rating_action_risk || 0)}">${company.rating_action_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.cash_flow_risk || 0)}">${company.cash_flow_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.refinancing_risk || 0)}">${company.refinancing_risk || 0}</span></td>
                        <td><span class="risk-badge ${getRiskLevelClass(company.sponsor_profile_risk || 0)}">${company.sponsor_profile_risk || 0}</span></td>
                        <td>
                            <button onclick="removeCompany('${company.name}')" class="btn-danger">Remove</button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
            
            // Also update the recommended actions panel
            displayRecommendedActions(companies);
        }

        // Function to display recommended actions
        function displayRecommendedActions(companies) {
            const contentDiv = document.getElementById('recommendedActionsContent');
            
            if (!companies || companies.length === 0) {
                contentDiv.innerHTML = '<div class="no-data">No companies monitored yet. Add companies to see AI-powered recommendations.</div>';
                return;
            }

            let html = '';
            let validCompanies = 0;
            
            companies.forEach(company => {
                // Ensure we have the required data for recommendations
                if (!company.name || company.current_rds_score === undefined) {
                    return; // Skip companies with incomplete data
                }
                
                validCompanies++;
                const riskClass = getRiskLevelClass(company.current_rds_score);
                const urgency = getUrgencyLevel(company.current_rds_score);
                const recommendedAction = company.recommended_action || getRecommendedAction(company.current_rds_score);
                const riskLevel = company.risk_level || getRiskLevel(company.current_rds_score);
                const defaultTimeline = company.default_timeline || estimateDefaultTimeline(company.current_rds_score);
                
                html += `
                    <div class="recommendation-card ${riskClass}">
                        <div class="recommendation-header">
                            <div class="company-name-large">${company.name}</div>
                            <div class="recommendation-badge ${recommendedAction.toLowerCase().replace(/ /g, '-')}">
                                ${recommendedAction}
                            </div>
                        </div>
                        
                        <div class="recommendation-details">
                            <div class="detail-item">
                                <div class="detail-label">RDS Score</div>
                                <div class="detail-value">${company.current_rds_score}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Risk Level</div>
                                <div class="detail-value">${riskLevel}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Default Timeline</div>
                                <div class="detail-value">${defaultTimeline}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Urgency</div>
                                <div class="detail-value">
                                    <span class="urgency-indicator">
                                        <span class="urgency-dot ${urgency}"></span>
                                        ${urgency.toUpperCase()}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="recommendation-reasoning">
                            <div class="reasoning-title">AI Reasoning for ${recommendedAction}:</div>
                            <ul class="reasoning-list">
                                ${generateAIReasoning(company).map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="recommendation-actions">
                            <button onclick="viewEnhancedCompanyDetails('${company.name}')" class="btn-secondary">View Full Analysis</button>
                            <button onclick="removeCompany('${company.name}')" class="btn-danger">Remove from Monitor</button>
                        </div>
                    </div>
                `;
            });
            
            if (validCompanies === 0) {
                contentDiv.innerHTML = '<div class="no-data">Companies found but insufficient data for AI recommendations. Please ensure companies have complete financial data.</div>';
            } else if (html === '') {
                contentDiv.innerHTML = '<div class="no-data">No valid companies found for recommendations.</div>';
            } else {
                contentDiv.innerHTML = html;
            }
        }

        // Helper function to get urgency level
        function getUrgencyLevel(rdsScore) {
            if (rdsScore >= 80) return 'critical';
            if (rdsScore >= 60) return 'high';
            if (rdsScore >= 40) return 'medium';
            return 'low';
        }

        // Helper function to generate AI reasoning
        function generateAIReasoning(company) {
            const reasoning = [];
            const rdsScore = company.current_rds_score;
            
            // Base reasoning on RDS score
            if (rdsScore >= 80) {
                reasoning.push('Extreme leverage and poor interest coverage indicate imminent default risk');
                reasoning.push('CDS spreads and market sentiment suggest market expects failure');
                reasoning.push('Multiple critical risk factors align, requiring immediate action');
            } else if (rdsScore >= 60) {
                reasoning.push('High leverage combined with declining EBITDA trends');
                reasoning.push('Weak liquidity and poor cash flow coverage');
                reasoning.push('Industry headwinds amplify existing financial stress');
            } else if (rdsScore >= 40) {
                reasoning.push('Moderate risk with some concerning trends');
                reasoning.push('Monitor for deterioration in key metrics');
                reasoning.push('Consider reducing exposure if conditions worsen');
                } else {
                reasoning.push('Low risk profile with stable fundamentals');
                reasoning.push('Continue monitoring for any material changes');
                reasoning.push('Maintain current position with regular review');
            }
            
            // Add specific reasoning based on company data
            if (company.leverage_risk > 6) {
                reasoning.push('Leverage significantly above industry average');
            }
            
            if (company.interest_coverage_risk < 1.5) {
                reasoning.push('Interest coverage below sustainable threshold');
            }
            
            if (company.liquidity_risk < 1.0) {
                reasoning.push('Liquidity ratios indicate potential cash flow issues');
            }
            
            return reasoning;
        }

        // Utility Functions for RDS Analysis
        function getRdsScoreClass(score) {
            if (score >= 80) return 'critical';
            if (score >= 60) return 'high';
            if (score >= 40) return 'medium';
            if (score >= 20) return 'low';
            return 'very-low';
        }

        function getRiskLevel(score) {
            if (score >= 80) return 'EXTREME';
            if (score >= 60) return 'HIGH';
            if (score >= 40) return 'MEDIUM';
            if (score >= 20) return 'LOW';
            return 'VERY LOW';
        }

        function getRecommendedAction(score) {
            if (score >= 80) return 'SHORT FULL';
            if (score >= 70) return 'SHORT FULL';
            if (score >= 60) return 'SHORT HALF';
            if (score >= 40) return 'MONITOR CLOSELY';
            if (score >= 20) return 'CAUTIOUS';
            return 'AVOID';
        }

        function estimateDefaultTimeline(score) {
            if (score >= 80) return '< 3 months';
            if (score >= 70) return '3-6 months';
            if (score >= 60) return '6-12 months';
            if (score >= 40) return '1-2 years';
            if (score >= 20) return '2-5 years';
            return '> 5 years';
        }

        // Add company to monitoring from search results
        async function addCompanyToMonitor(companyName) {
            try {
                const response = await fetch('/api/add-company', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ company_name: companyName })
                });

                if (response.ok) {
                    alert(`${companyName} has been added to monitoring!`);
                    // Reload dashboard data to show the new company
                    loadDashboardData();
                } else {
                    const error = await response.json();
                    alert(`Error adding company: ${error.error}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        // View company details - SIMPLIFIED APPROACH
        async function viewCompanyDetails(companyName) {
            try {
                console.log('Loading company details for:', companyName);
                const response = await fetch(`/api/company-details/${encodeURIComponent(companyName)}`);
                if (response.ok) {
                const data = await response.json();
                    console.log('Full API response:', data);
                    
                    if (data.success && data.company) {
                    const company = data.company;
                        console.log('Company data received:', company);
                        
                        // Create full-page liquid glass modal
                        const modalHtml = `
                            <div id="company-modal" class="full-page-modal">
                                <div class="modal-backdrop"></div>
                                <div class="modal-content-full">
                                    <div class="modal-header-full">
                                        <h2 class="modal-title">${company.name} - Comprehensive Analysis</h2>
                                        <button onclick="closeModal()" class="close-btn-full">&times;</button>
                            </div>
                                    <div class="modal-body-full">
                                        <div class="company-overview-full">
                                            <div class="overview-grid-full">
                                                <div class="overview-card">
                                                    <div class="card-label">Ticker</div>
                                                    <div class="card-value">${company.ticker || 'N/A'}</div>
                                        </div>
                                                <div class="overview-card">
                                                    <div class="card-label">Sector</div>
                                                    <div class="card-value">${company.sector || 'N/A'}</div>
                                        </div>
                                                <div class="overview-card">
                                                    <div class="card-label">PE Sponsor</div>
                                                    <div class="card-value">${company.pe_sponsor || 'N/A'}</div>
                                        </div>
                                                <div class="overview-card rds-score-card">
                                                    <div class="card-label">RDS Score</div>
                                                    <div class="card-value rds-score-full ${company.current_rds_score > 70 ? 'critical' : company.current_rds_score > 50 ? 'high' : 'low'}">${company.current_rds_score}</div>
                                        </div>
                                                <div class="overview-card">
                                                    <div class="card-label">Risk Level</div>
                                                    <div class="card-value risk-badge-full ${company.risk_level?.toLowerCase().replace(' ', '-') || 'unknown'}">${company.risk_level || 'N/A'}</div>
                                        </div>
                                                <div class="overview-card">
                                                    <div class="card-label">Recommended Action</div>
                                                    <div class="card-value action-badge-full ${company.recommended_action?.toLowerCase().replace(/ /g, '-') || 'unknown'}">${company.recommended_action || 'N/A'}</div>
                                        </div>
                                                <div class="overview-card markov-probability-card">
                                                    <div class="card-label">6M Default Probability</div>
                                                    <div class="card-value markov-prob-6m">Loading...</div>
                                                </div>
                                                <div class="overview-card markov-probability-card">
                                                    <div class="card-label">12M Default Probability</div>
                                                    <div class="card-value markov-prob-12m">Loading...</div>
                                                </div>
                                                <div class="overview-card markov-probability-card">
                                                    <div class="card-label">24M Default Probability</div>
                                                    <div class="card-value markov-prob-24m">Loading...</div>
                                                </div>
                                                <div class="overview-card markov-probability-card">
                                                    <div class="card-label">Expected Time to Default</div>
                                                    <div class="card-value markov-etd">Loading...</div>
                                                </div>
                                                <div class="overview-card">
                                                    <div class="card-label">Debt to EBITDA</div>
                                                    <div class="card-value">${company.debt_to_ebitda || 'N/A'}</div>
                                                </div>
                                    </div>
                                </div>
                                        
                                        <div class="rds-breakdown-full">
                                            <h3 class="section-title">RDS Criteria Breakdown</h3>
                                            <div class="criteria-grid-full">
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Leverage Risk</div>
                                                    <div class="criteria-score ${company.leverage_risk > 15 ? 'critical' : company.leverage_risk > 10 ? 'high' : 'low'}">${company.leverage_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Interest Coverage Risk</div>
                                                    <div class="criteria-score ${company.interest_coverage_risk > 12 ? 'critical' : company.interest_coverage_risk > 8 ? 'high' : 'low'}">${company.interest_coverage_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Liquidity Risk</div>
                                                    <div class="criteria-score ${company.liquidity_risk > 8 ? 'critical' : company.liquidity_risk > 5 ? 'high' : 'low'}">${company.liquidity_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">CDS Market Risk</div>
                                                    <div class="criteria-score ${company.cds_market_risk > 8 ? 'critical' : company.cds_market_risk > 5 ? 'high' : 'low'}">${company.cds_market_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Dividend Risk</div>
                                                    <div class="criteria-score ${company.dividend_risk > 12 ? 'critical' : company.dividend_risk > 8 ? 'high' : 'low'}">${company.dividend_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Floating Debt Risk</div>
                                                    <div class="criteria-score ${company.floating_debt_risk > 4 ? 'critical' : company.floating_debt_risk > 2 ? 'high' : 'low'}">${company.floating_debt_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Rating Action Risk</div>
                                                    <div class="criteria-score ${company.rating_action_risk > 4 ? 'critical' : company.rating_action_risk > 2 ? 'high' : 'low'}">${company.rating_action_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Cash Flow Risk</div>
                                                    <div class="criteria-score ${company.cash_flow_risk > 8 ? 'critical' : company.cash_flow_risk > 5 ? 'high' : 'low'}">${company.cash_flow_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Refinancing Risk</div>
                                                    <div class="criteria-score ${company.refinancing_risk > 4 ? 'critical' : company.refinancing_risk > 2 ? 'high' : 'low'}">${company.refinancing_risk || 0}</div>
                                                </div>
                                                <div class="criteria-card">
                                                    <div class="criteria-label">Sponsor Profile Risk</div>
                                                    <div class="criteria-score ${company.sponsor_profile_risk > 4 ? 'critical' : company.sponsor_profile_risk > 2 ? 'high' : 'low'}">${company.sponsor_profile_risk || 0}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Remove any existing modal
                        const existingModal = document.getElementById('company-modal');
                        if (existingModal) {
                            existingModal.remove();
                        }
                        
                        // Add the new modal
                        document.body.insertAdjacentHTML('beforeend', modalHtml);
                        console.log('Simple modal added to DOM');
                                
                                <div class="rds-criteria-breakdown">
                                    <h4>RDS Criteria Breakdown (All 10 Factors)</h4>
                                    <div class="criteria-grid">
                                        <div class="criteria-item">
                                            <span class="criteria-name">1. Leverage Risk (20%)</span>
                                            <span class="criteria-score">${company.leverage_risk || 0}/20</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">2. Interest Coverage (15%)</span>
                                            <span class="criteria-score">${company.interest_coverage_risk || 0}/15</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">3. Liquidity Risk (10%)</span>
                                            <span class="criteria-score">${company.liquidity_risk || 0}/10</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">4. CDS Market (10%)</span>
                                            <span class="criteria-score">${company.cds_market_risk || 0}/10</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">5. Dividend Risk (15%)</span>
                                            <span class="criteria-score">${company.dividend_risk || 0}/15</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">6. Floating Debt (5%)</span>
                                            <span class="criteria-score">${company.floating_debt_risk || 0}/5</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">7. Rating Action (5%)</span>
                                            <span class="criteria-score">${company.rating_action_risk || 0}/5</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">8. Cash Flow (10%)</span>
                                            <span class="criteria-score">${company.cash_flow_risk || 0}/10</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">9. Refinancing (5%)</span>
                                            <span class="criteria-score">${company.refinancing_risk || 0}/5</span>
                                        </div>
                                        <div class="criteria-item">
                                            <span class="criteria-name">10. Sponsor Profile (5%)</span>
                                            <span class="criteria-score">${company.sponsor_profile_risk || 0}/5</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Healthcare-specific risks (only for healthcare companies) -->
                                    ${(company.regulatory_sensitivity > 0 || company.operational_fragility > 0) ? `
                                    <div class="healthcare-risks-section">
                                        <h5>Healthcare-Specific Risks</h5>
                                        <div class="criteria-grid">
                                            <div class="criteria-item healthcare-bonus">
                                                <span class="criteria-name">Regulatory Sensitivity</span>
                                                <span class="criteria-score">${company.regulatory_sensitivity || 0}/1.5</span>
                                            </div>
                                            <div class="criteria-item healthcare-bonus">
                                                <span class="criteria-name">Operational Fragility</span>
                                                <span class="criteria-score">${company.operational_fragility || 0}/1.0</span>
                                            </div>
                                        </div>
                                        <div class="healthcare-note">
                                            <small>Note: Healthcare companies receive additional risk points for sector-specific vulnerabilities</small>
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                                
                                <div class="financial-metrics">
                                    <h4>Financial Metrics</h4>
                                    <div class="metrics-grid">
                                        <div class="metric-item">
                                            <span class="label">Debt/EBITDA:</span>
                                            <span class="value">${company.debt_to_ebitda || 'N/A'}</span>
                                        </div>
                                        <div class="metric-item">
                                            <span class="label">Interest Coverage:</span>
                                            <span class="value">${company.interest_coverage || 'N/A'}</span>
                                        </div>
                                        <div class="metric-item">
                                            <span class="label">Quick Ratio:</span>
                                            <span class="value">${company.quick_ratio || 'N/A'}</span>
                                        </div>
                                        <div class="metric-item">
                                            <span class="label">CDS Spread (5Y):</span>
                                            <span class="value">${company.cds_spread_5y || 'N/A'} bps</span>
                                        </div>
                                        <div class="metric-item">
                                            <span class="label">FCF Coverage:</span>
                                            <span class="value">${company.fcf_coverage || 'N/A'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="ai-analysis-section">
                                    <h4>Advanced AI Analysis</h4>
                                    <div class="ai-insights">
                                        ${company.ai_analysis ? `
                                            <div class="ai-insight">
                                                <strong>Pattern Recognition:</strong> ${company.ai_analysis.pattern_recognition}
                                            </div>
                                            <div class="ai-insight">
                                                <strong>Correlation Analysis:</strong> ${company.ai_analysis.correlation_analysis}
                                            </div>
                                            <div class="ai-insight">
                                                <strong>Predictive Modeling:</strong> ${company.ai_analysis.predictive_modeling}
                                            </div>
                                            <div class="ai-insight">
                                                <strong>Sector Context:</strong> ${company.ai_analysis.sector_context}
                                            </div>
                                            <div class="ai-insight">
                                                <strong>Market Sentiment:</strong> ${company.ai_analysis.market_sentiment}
                                            </div>
                                        ` : 'AI analysis data not available'}
                                    </div>
                                </div>
                                
                                <div class="sec-filings-section">
                                    <h4>SEC Filing Analysis</h4>
                                    <div class="filings-list">
                                        ${company.sec_filings ? company.sec_filings.map(filing => `
                                            <div class="filing-item">
                                                <div class="filing-header">
                                                    <span class="filing-type">${filing.filing_type}</span>
                                                    <span class="filing-date">${filing.filing_date}</span>
                                                </div>
                                                <div class="filing-ai">${filing.ai_analysis}</div>
                                                <div class="risk-factors">
                                                    ${filing.risk_factors.map(factor => `<div class="risk-factor">• ${factor}</div>`).join('')}
                                                </div>
                                            </div>
                                        `).join('') : 'SEC filing data not available'}
                                    </div>
                                </div>
                                
                                <div class="recent-news-section">
                                    <h4>Recent News & Updates</h4>
                                    <div class="news-list">
                                        ${company.recent_news ? company.recent_news.map(news => `
                                            <div class="news-item">
                                                <div class="news-header">
                                                    <span class="news-headline">${news.headline}</span>
                                                    <span class="news-date">${new Date(news.timestamp).toLocaleDateString()}</span>
                                                </div>
                                                <div class="news-summary">${news.summary}</div>
                                                <div class="news-impact">
                                                    <span class="impact-label">RDS Impact:</span>
                                                    <span class="impact-value ${news.rds_impact.toLowerCase()}">${news.rds_impact}</span>
                                                    <span class="score-change">Score Change: ${news.score_change > 0 ? '+' : ''}${news.score_change}</span>
                                                </div>
                                            </div>
                                        `).join('') : 'Recent news data not available'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Display the modal
                        console.log('Adding modal to DOM...');
                    document.body.insertAdjacentHTML('beforeend', modalHtml);
                        console.log('Modal added to DOM');
                        
                        // Ensure modal is visible
                        const modal = document.getElementById('company-modal');
                        if (modal) {
                            modal.style.display = 'flex';
                            modal.style.zIndex = '1000';
                            console.log('Modal should now be visible');
                } else {
                            console.error('Modal not found after insertion');
                        }
                        
                        // Load Markov analysis for the overview cards
                        console.log('Loading Markov analysis for overview cards...');
                        await loadMarkovAnalysisToOverview(companyName);
                        
                    } else {
                        console.error('Invalid response structure:', data);
                        console.log('Invalid company data received - check API response');
                    }
                } else {
                    console.error('API response not ok:', response.status);
                    console.log('API request failed - check server logs');
                }
            } catch (error) {
                console.error('Error viewing company details:', error);
                console.log('Network or parsing error occurred');
            }
        }

        // Close company details modal
        function closeCompanyDetails() {
            const modal = document.querySelector('.company-details-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Close simple modal
        function closeModal() {
            const modal = document.getElementById('company-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Remove company from monitoring
        async function removeCompany(companyName) {
            if (!confirm(`Are you sure you want to remove ${companyName} from monitoring?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/remove-company', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ company_name: companyName })
                });

                if (response.ok) {
                    alert(`${companyName} has been removed from monitoring!`);
                    // Reload dashboard data to update the display
                    loadDashboardData();
                } else {
                    const error = await response.json();
                    alert(`Error removing company: ${error.error}`);
                }
            } catch (error) {
                console.error('Error removing company:', error);
                alert('Error removing company');
            }
        }

        // Load Markov Chain analysis and populate overview cards
        async function loadMarkovAnalysisToOverview(companyName) {
            try {
                console.log(`Loading Markov analysis for ${companyName}`);
                const response = await fetch(`/api/markov-analysis/${encodeURIComponent(companyName)}`);
                const data = await response.json();
                
                if (data.success) {
                    const analysis = data.markov_analysis;
                    console.log('Markov analysis loaded:', analysis);
                    
                    // Update the overview cards with Markov probabilities
                    const prob6m = document.querySelector('.markov-prob-6m');
                    const prob12m = document.querySelector('.markov-prob-12m');
                    const prob24m = document.querySelector('.markov-prob-24m');
                    const etd = document.querySelector('.markov-etd');
                    
                    if (prob6m) {
                        prob6m.innerHTML = `${(analysis.prob_default_6m * 100).toFixed(1)}%`;
                        prob6m.className = `card-value markov-prob-6m ${getMarkovRiskClass(analysis.prob_default_6m * 100)}`;
                    }
                    if (prob12m) {
                        prob12m.innerHTML = `${(analysis.prob_default_12m * 100).toFixed(1)}%`;
                        prob12m.className = `card-value markov-prob-12m ${getMarkovRiskClass(analysis.prob_default_12m * 100)}`;
                    }
                    if (prob24m) {
                        prob24m.innerHTML = `${(analysis.prob_default_24m * 100).toFixed(1)}%`;
                        prob24m.className = `card-value markov-prob-24m ${getMarkovRiskClass(analysis.prob_default_24m * 100)}`;
                    }
                    if (etd) {
                        etd.innerHTML = `${analysis.expected_time_to_default.toFixed(1)} months`;
                        etd.className = `card-value markov-etd ${getETDRiskClass(analysis.expected_time_to_default)}`;
                    }
                    
                    console.log('Markov overview cards updated successfully');
                } else {
                    console.error('Markov analysis failed:', data.error);
                    // Update cards with error state
                    document.querySelectorAll('.markov-prob-6m, .markov-prob-12m, .markov-prob-24m, .markov-etd').forEach(card => {
                        card.innerHTML = 'N/A';
                        card.className = card.className.replace('card-value', 'card-value error');
                    });
                }
            } catch (error) {
                console.error('Error loading Markov analysis:', error);
                // Update cards with error state
                document.querySelectorAll('.markov-prob-6m, .markov-prob-12m, .markov-prob-24m, .markov-etd').forEach(card => {
                    card.innerHTML = 'Error';
                    card.className = card.className.replace('card-value', 'card-value error');
                });
            }
        }

        // Get risk class for Markov probabilities
        function getMarkovRiskClass(probability) {
            if (probability >= 25) return 'critical';
            if (probability >= 15) return 'high';
            if (probability >= 8) return 'medium';
            return 'low';
        }

        // Get risk class for Expected Time to Default
        function getETDRiskClass(months) {
            if (months <= 6) return 'critical';
            if (months <= 12) return 'high';
            if (months <= 24) return 'medium';
            return 'low';
        }

        // View enhanced company details with all Bloomberg API data
        async function viewEnhancedCompanyDetails(companyName) {
            try {
                // Fetch all advanced Bloomberg API data
                const [newsData, sentimentData, peerData, industryData, advancedData, lpData] = await Promise.allSettled([
                    fetch(`/api/company-news/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/market-sentiment/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/peer-analysis/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/industry-stats/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/advanced-scoring/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null),
                    fetch(`/api/lp-analysis/${encodeURIComponent(companyName)}`).then(r => r.ok ? r.json() : null)
                ]);

                // Create comprehensive analysis display
                let analysisHtml = `
                    <div class="enhanced-analysis-modal">
                        <h3>Comprehensive Analysis: ${companyName}</h3>
                        <div class="analysis-sections">
                `;

                // News & Sentiment Section
                if (newsData.value && sentimentData.value) {
                    analysisHtml += `
                        <div class="analysis-section">
                            <h4>News & Market Sentiment</h4>
                            <div class="sentiment-summary">
                                <span class="sentiment-label">Overall Sentiment:</span>
                                <span class="sentiment-value ${getSentimentClass(sentimentData.value.sentiment)}">${sentimentData.value.sentiment}</span>
                                <span class="confidence">Confidence: ${sentimentData.value.confidence}%</span>
                            </div>
                            <div class="news-preview">
                                ${newsData.value.slice(0, 3).map(item => `
                                    <div class="news-preview-item">
                                        <div class="news-title">${item.title}</div>
                                        <div class="news-date">${item.date}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                // Peer Analysis Section
                if (peerData.value) {
                    analysisHtml += `
                        <div class="analysis-section">
                            <h4>Peer Company Analysis</h4>
                            <div class="peer-summary">
                                <span class="peer-label">Average RDS Score:</span>
                                <span class="peer-value ${getRiskClass(peerData.value.avg_rds_score)}">${Math.round(peerData.value.avg_rds_score || 0)}</span>
                    </div>
                            <div class="peer-companies">
                                ${peerData.value.peers?.slice(0, 3).map(peer => `
                                    <div class="peer-item">
                                        <span class="peer-name">${peer.name}</span>
                                        <span class="peer-rds">RDS: ${peer.rds_score}</span>
                    </div>
                                `).join('') || 'No peer data available'}
                    </div>
                </div>
            `;
                }

                // Industry Statistics Section
                if (industryData.value) {
                    analysisHtml += `
                        <div class="industry-section">
                            <h4>Industry Statistics</h4>
                            <div class="industry-summary">
                                <div class="industry-metric">
                                    <span class="metric-label">Default Rate:</span>
                                    <span class="metric-value ${getRiskClass(industryData.value.default_rate)}">${industryData.value.default_rate}%</span>
                                </div>
                                <div class="industry-metric">
                                    <span class="metric-label">Average Leverage:</span>
                                    <span class="metric-value">${industryData.value.avg_leverage}x</span>
                                </div>
                                <div class="industry-metric">
                                    <span class="metric-label">Risk Level:</span>
                                    <span class="metric-value ${industryData.value.risk_level.toLowerCase()}">${industryData.value.risk_level}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Advanced Scoring Section
                if (advancedData.value) {
                    analysisHtml += `
                        <div class="analysis-section">
                            <h4>Advanced AI Scoring</h4>
                            <div class="advanced-scoring-summary">
                                <pre class="scoring-data">${JSON.stringify(advancedData.value, null, 2)}</pre>
                            </div>
                        </div>
                    `;
                }

                // LP Analysis Section
                if (lpData.value) {
                    analysisHtml += `
                        <div class="analysis-section">
                            <h4>LP Report Analysis</h4>
                            <div class="lp-summary">
                                <div class="lp-metric">
                                    <span class="metric-label">Carried Interest Probability:</span>
                                    <span class="metric-value">${lpData.value.carried_interest_probability}%</span>
                    </div>
                                <div class="lp-metric">
                                    <span class="metric-label">LP Analysis Count:</span>
                                    <span class="metric-value">${lpData.value.lp_analysis_count}</span>
                    </div>
                    </div>
                </div>
            `;
                }

                analysisHtml += `
                        </div>
                        <div class="modal-actions">
                            <button onclick="addCompanyToMonitor('${companyName}')" class="btn-primary">Add to Monitor</button>
                            <button onclick="closeEnhancedAnalysis()" class="btn-secondary">Close</button>
                        </div>
                    </div>
                `;

                // Display the comprehensive analysis
                const resultsDiv = document.getElementById('searchResults');
                resultsDiv.innerHTML = analysisHtml;

            } catch (error) {
                console.error('Error fetching enhanced company details:', error);
                alert(`Error loading enhanced analysis for ${companyName}: ${error.message}`);
            }
        }

        // Helper functions for styling
        function getSentimentClass(sentiment) {
            if (!sentiment) return 'neutral';
            const lower = sentiment.toLowerCase();
            if (lower.includes('positive') || lower.includes('bullish')) return 'positive';
            if (lower.includes('negative') || lower.includes('bearish')) return 'negative';
            return 'neutral';
        }

        function getRiskClass(value) {
            if (!value || isNaN(value)) return 'unknown';
            if (value >= 8) return 'critical';
            if (value >= 6) return 'high';
            if (value >= 4) return 'medium';
            if (value >= 2) return 'low';
            return 'very-low';
        }

        function closeEnhancedAnalysis() {
            // Reload the search results
            const industry = document.getElementById('industrySelect').value;
            const companyCount = document.getElementById('companyCountInput').value;
            if (industry && companyCount) {
                searchCompanies();
            }
        }

        // Unified Analysis Function
        async function performUnifiedAnalysis() {
            const companyName = document.getElementById('unifiedCompanyInput').value.trim();
            const analysisType = document.getElementById('analysisTypeSelect').value;
            const resultsDiv = document.getElementById('unifiedAnalysisResults');

            if (!companyName) {
                alert('Please enter a company name');
                return;
            }

            if (!analysisType) {
                alert('Please select an analysis type');
                return;
            }

            resultsDiv.innerHTML = '<div class="loading">Performing analysis...</div>';

            try {
                let response;
                let endpoint;

                switch (analysisType) {
                    case 'news':
                        // Get both news and sentiment
                        const [newsResponse, sentimentResponse] = await Promise.all([
                            fetch(`/api/company-news/${encodeURIComponent(companyName)}`),
                            fetch(`/api/market-sentiment/${encodeURIComponent(companyName)}`)
                        ]);
                        
                        if (newsResponse.ok && sentimentResponse.ok) {
                            const news = await newsResponse.json();
                            const sentiment = await sentimentResponse.json();
                            displayUnifiedNewsResults(news, sentiment, companyName);
                        } else {
                            resultsDiv.innerHTML = '<div class="error">Error fetching news and sentiment data</div>';
                        }
                        return;

                    case 'peer':
                        // Get both peer analysis and industry stats
                        const [peerResponse, industryResponse] = await Promise.all([
                            fetch(`/api/peer-analysis/${encodeURIComponent(companyName)}`),
                            fetch(`/api/industry-stats/${encodeURIComponent(companyName)}`)
                        ]);
                        
                        if (peerResponse.ok && industryResponse.ok) {
                            const peer = await peerResponse.json();
                            const industry = await industryResponse.json();
                            displayUnifiedPeerResults(peer, industry, companyName);
                        } else {
                            resultsDiv.innerHTML = '<div class="error">Error fetching peer and industry data</div>';
                        }
                        return;

                    case 'advanced':
                        response = await fetch(`/api/advanced-scoring/${encodeURIComponent(companyName)}`);
                        endpoint = 'Advanced Scoring';
                        break;

                    case 'lp':
                        response = await fetch(`/api/lp-analysis/${encodeURIComponent(companyName)}`);
                        endpoint = 'LP Analysis';
                        break;

                    case 'portfolio':
                        // For portfolio analysis, we need to handle it differently
                        resultsDiv.innerHTML = '<div class="info">Portfolio analysis requires multiple company names. Please use the Company Search section for portfolio analysis.</div>';
                        return;

                    default:
                        resultsDiv.innerHTML = '<div class="error">Invalid analysis type selected</div>';
                        return;
                }

                if (response.ok) {
                    const data = await response.json();
                    displayUnifiedAnalysisResults(data, analysisType, companyName);
                } else {
                    resultsDiv.innerHTML = `<div class="error">Error performing ${endpoint} analysis</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">Error: ' + error.message + '</div>';
            }
        }

        // Display functions for unified analysis results
        function displayUnifiedNewsResults(news, sentiment, companyName) {
            const resultsDiv = document.getElementById('unifiedAnalysisResults');
            
            let html = `
                <div class="unified-results">
                    <h4>News & Market Sentiment Analysis for ${companyName}</h4>
                    <div class="results-grid">
                        <div class="news-section">
                            <h5>Recent News</h5>
                            ${news.length > 0 ? news.map(item => `
                                <div class="news-item">
                                    <div class="news-title">${item.title}</div>
                                    <div class="news-summary">${item.summary}</div>
                                    <div class="news-meta">
                                        <span class="news-date">${item.date}</span>
                                        <span class="news-source">${item.source}</span>
                                    </div>
                                </div>
                            `).join('') : '<div class="no-data">No recent news available</div>'}
                        </div>
                        <div class="sentiment-section">
                            <h5>Market Sentiment</h5>
                            <div class="sentiment-data">
                                <div class="sentiment-metric">
                                    <span class="metric-label">Overall Sentiment:</span>
                                    <span class="metric-value ${sentiment.sentiment}">${sentiment.sentiment}</span>
                                </div>
                                <div class="sentiment-metric">
                                    <span class="metric-label">Confidence:</span>
                                    <span class="metric-value">${sentiment.confidence}%</span>
                                </div>
                                <div class="sentiment-metric">
                                    <span class="metric-label">Key Factors:</span>
                                    <ul class="sentiment-factors">
                                        ${sentiment.factors.map(factor => `<li>${factor}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="analysis-actions">
                        <button onclick="addCompanyToMonitor('${companyName}')" class="btn-primary">Add ${companyName} to Monitor</button>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        function displayUnifiedPeerResults(peer, industry, companyName) {
            const resultsDiv = document.getElementById('unifiedAnalysisResults');
            
            let html = `
                <div class="unified-results">
                    <h4>Peer Analysis & Industry Statistics for ${companyName}</h4>
                    <div class="results-grid">
                        <div class="peer-section">
                            <h5>Peer Company Analysis</h5>
                            ${peer.peers.length > 0 ? peer.peers.map(peerCompany => `
                                <div class="peer-item">
                                    <div class="peer-name">${peerCompany.name}</div>
                                    <div class="peer-metrics">
                                        <span class="metric">RDS: ${peerCompany.rds_score}</span>
                                        <span class="metric">Leverage: ${peerCompany.leverage_ratio}x</span>
                                        <span class="metric">Rating: ${peerCompany.rating}</span>
                                    </div>
                                </div>
                            `).join('') : '<div class="no-data">No peer companies found</div>'}
                        </div>
                        <div class="industry-section">
                            <h5>Industry Statistics</h5>
                            <div class="industry-data">
                                <div class="industry-metric">
                                    <span class="metric-label">Default Rate:</span>
                                    <span class="metric-value">${industry.default_rate}%</span>
                                </div>
                                <div class="industry-metric">
                                    <span class="metric-label">Average Leverage:</span>
                                    <span class="metric-value">${industry.avg_leverage}x</span>
                                </div>
                                <div class="industry-metric">
                                    <span class="metric-label">Risk Level:</span>
                                    <span class="metric-value ${industry.risk_level.toLowerCase()}">${industry.risk_level}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="analysis-actions">
                        <button onclick="addCompanyToMonitor('${companyName}')" class="btn-primary">Add ${companyName} to Monitor</button>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        function displayUnifiedAnalysisResults(data, analysisType, companyName) {
            const resultsDiv = document.getElementById('unifiedAnalysisResults');
            
            let html = `
                <div class="unified-results">
                    <h4>${analysisType.charAt(0).toUpperCase() + analysisType.slice(1)} Analysis Results for ${companyName}</h4>
                    <div class="analysis-content">
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                    <div class="analysis-actions">
                        <button onclick="addCompanyToMonitor('${companyName}')" class="btn-primary">Add ${companyName} to Monitor</button>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // LLM-Powered PE Discovery Functions
        function discoverPEWithLLM() {
            const query = document.getElementById('llm-pe-query').value.trim();
            const maxResults = document.getElementById('llm-max-results').value;
            
            if (!query) {
                alert('Please enter a natural language query');
                return;
            }
            
            const requestData = {
                query: query,
                max_results: parseInt(maxResults)
            };
            
            const resultsDiv = document.getElementById('llm-pe-results');
            resultsDiv.innerHTML = '<div class="loading">🧠 LLM is analyzing your query and discovering PE companies...</div>';
            
            fetch('/api/discover-pe-with-llm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayLLMPEResults(data.companies, data.query, data.total_found);
                } else {
                    resultsDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultsDiv.innerHTML = '<div class="error">Error discovering PE companies with LLM</div>';
            });
        }

        function displayLLMPEResults(companies, query, totalFound) {
            const resultsDiv = document.getElementById('llm-pe-results');
            
            let html = `
                <div class="results-summary">
                    <h4>🧠 LLM Discovery Results</h4>
                    <p><strong>Query:</strong> "${query}"</p>
                    <p><strong>Found:</strong> ${totalFound} PE portfolio companies</p>
                    <p><strong>Source:</strong> Bloomberg PE Database + LLM Intelligence</p>
                </div>
                <div class="companies-grid">
            `;
            
            companies.forEach(company => {
                html += `
                    <div class="company-card llm-discovered">
                        <div class="company-header">
                            <h5>${company.name}</h5>
                            <span class="pe-firm">${company.pe_firm_name}</span>
                            <span class="llm-badge">🧠 LLM Found</span>
                        </div>
                        <div class="company-details">
                            <p><strong>Sector:</strong> ${company.sector}</p>
                            <p><strong>Industry:</strong> ${company.industry}</p>
                            <p><strong>Investment Size:</strong> $${(company.investment_size / 1000000).toFixed(1)}M</p>
                            <p><strong>Ownership:</strong> ${company.ownership_percentage}%</p>
                            <p><strong>LBO Date:</strong> ${company.lbo_date || 'N/A'}</p>
                        </div>
                        <div class="company-actions">
                            <button onclick="addCompanyToMonitor('${company.name}')" class="btn-primary">Add to Monitor</button>
                            <button onclick="analyzeCompany('${company.name}')" class="btn-secondary">Analyze</button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        // High-Risk PE Discovery Functions
        function discoverHighRiskPE() {
            const riskThreshold = document.getElementById('risk-threshold').value;
            const maxCompanies = document.getElementById('max-high-risk-companies').value;
            
            const requestData = {
                risk_threshold: parseFloat(riskThreshold),
                max_companies: parseInt(maxCompanies)
            };
            
            fetch('/api/discover-high-risk-pe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayHighRiskResults(data.companies, data.total_found, data.risk_threshold);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error discovering high-risk PE companies');
            });
        }

        function displayHighRiskResults(companies, totalFound, riskThreshold) {
            const resultsDiv = document.getElementById('high-risk-results');
            const companiesListDiv = document.getElementById('high-risk-companies-list');
            
            resultsDiv.style.display = 'block';
            
            let html = `
                <div class="results-summary">
                    <h4>Found ${totalFound} High-Risk PE Portfolio Companies (RDS > ${riskThreshold})</h4>
                    <p>Source: Bloomberg PE Database (33,000+ PE firms)</p>
                </div>
                <div class="companies-grid">
            `;
            
            companies.forEach(company => {
                html += `
                    <div class="company-card high-risk">
                        <div class="company-header">
                            <h5>${company.name}</h5>
                            <span class="pe-firm">${company.pe_firm_name}</span>
                        </div>
                        <div class="company-details">
                            <p><strong>Sector:</strong> ${company.sector}</p>
                            <p><strong>Industry:</strong> ${company.industry}</p>
                            <p><strong>Investment Size:</strong> $${(company.investment_size / 1000000).toFixed(1)}M</p>
                            <p><strong>Ownership:</strong> ${company.ownership_percentage}%</p>
                            <p><strong>LBO Date:</strong> ${company.lbo_date || 'N/A'}</p>
                        </div>
                        <div class="company-actions">
                            <button onclick="addCompanyToMonitor('${company.name}')" class="btn-primary">Add to Monitor</button>
                            <button onclick="analyzeCompany('${company.name}')" class="btn-secondary">Analyze</button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            companiesListDiv.innerHTML = html;
        }
    </script>

    <!-- Sketchy PE Firms Section -->
    <div id="sketchy-pe-firms-section" class="section" style="display: none;">
        <div class="section-header">
            <h2>PE Firms with High-Risk Practices</h2>
            <p>Private equity firms known for aggressive tactics, dividend recaps, and portfolio company distress</p>
        </div>

        <div class="glass-panel">
            <h3>High-Risk PE Firms by Practice</h3>
            <div class="sketchy-firms-grid">
                <div class="firm-category">
                    <h4>Aggressive Dividend Recappers</h4>
                    <div class="firm-list">
                        <div class="firm-item critical">
                            <strong>Apollo Global Management</strong>
                            <span class="risk-badge critical">Critical Risk</span>
                            <p>Known for aggressive dividend recaps within 18 months of acquisition</p>
                </div>
                        <div class="firm-item high">
                            <strong>KKR & Co.</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Frequent dividend recaps and high leverage strategies</p>
                    </div>
                        <div class="firm-item high">
                            <strong>TPG Capital</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive dividend extraction and portfolio company stress</p>
                </div>
                        <div class="firm-item high">
                            <strong>Bain Capital</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Quick dividend extractions and aggressive leverage</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Blackstone Inc.</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Dividend recaps in select portfolio companies</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Leonard Green & Partners</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive dividend recaps and quick exits</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Warburg Pincus</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Moderate dividend recaps with some portfolio stress</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>General Atlantic</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Selective dividend recaps in growth companies</p>
                        </div>
                    </div>
            </div>

                <div class="firm-category">
                    <h4>Portfolio Company Distress Specialists</h4>
                    <div class="firm-list">
                        <div class="firm-item critical">
                            <strong>Sycamore Partners</strong>
                            <span class="risk-badge critical">Critical Risk</span>
                            <p>Multiple portfolio company bankruptcies (Bed Bath & Beyond, etc.)</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Sun Capital Partners</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Known for aggressive cost-cutting leading to company failures</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Cerberus Capital Management</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Multiple distressed portfolio companies and restructuring</p>
                        </div>
                        <div class="firm-item high">
                            <strong>H.I.G. Capital</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive cost-cutting and multiple portfolio company failures</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Platinum Equity</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Known for aggressive operational changes leading to distress</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Versa Capital Management</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Multiple portfolio company bankruptcies and liquidations</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Golden Gate Capital</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Some portfolio company stress and restructuring</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Thomas H. Lee Partners</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Occasional portfolio company distress</p>
                        </div>
                    </div>
                </div>

                <div class="firm-category">
                    <h4>Fast Exit Specialists</h4>
                    <div class="firm-list">
                        <div class="firm-item medium">
                            <strong>Bain Capital</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Quick flips and aggressive exit strategies</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Blackstone Inc.</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Fast exits and dividend recaps in select portfolio companies</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Leonard Green & Partners</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive dividend recaps and quick exits</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Clayton, Dubilier & Rice</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Quick operational improvements and fast exits</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Hellman & Friedman</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Selective fast exits in growth companies</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Silver Lake Partners</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Technology-focused quick exits</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Vista Equity Partners</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive software roll-ups and quick exits</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Thoma Bravo</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Software-focused quick flips</p>
                        </div>
                    </div>
                </div>

                <div class="firm-category">
                    <h4>Healthcare Sector Specialists</h4>
                    <div class="firm-list">
                        <div class="firm-item critical">
                            <strong>Partners Group</strong>
                            <span class="risk-badge critical">Critical Risk</span>
                            <p>Careismatic Brands bankruptcy - $833M debt elimination</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Welsh, Carson, Anderson & Stowe</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive healthcare roll-ups with high leverage</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>KKR (Healthcare Focus)</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Healthcare portfolio companies with high debt levels</p>
                        </div>
                        <div class="firm-item high">
                            <strong>TPG Capital (Healthcare)</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive healthcare acquisitions with high leverage</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Bain Capital (Healthcare)</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Healthcare roll-ups and aggressive cost-cutting</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>Blackstone (Healthcare)</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Selective healthcare investments with moderate leverage</p>
                        </div>
                        <div class="firm-item high">
                            <strong>Apollo (Healthcare)</strong>
                            <span class="risk-badge high">High Risk</span>
                            <p>Aggressive healthcare debt strategies</p>
                        </div>
                        <div class="firm-item medium">
                            <strong>General Atlantic (Healthcare)</strong>
                            <span class="risk-badge medium">Medium Risk</span>
                            <p>Growth-focused healthcare investments</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-panel">
            <h3>RDS Risk Factors by PE Firm Practice</h3>
            <div class="risk-factors">
                <div class="risk-factor">
                    <h4>Dividend Recap Risk (15% weight)</h4>
                    <p>PE firms that extract dividends within 18 months of acquisition significantly increase RDS scores</p>
                </div>
                <div class="risk-factor">
                    <h4>Sponsor Profile Risk (5% weight)</h4>
                    <p>Historical behavior of PE sponsors affects portfolio company risk assessment</p>
                </div>
                <div class="risk-factor">
                    <h4>Refinancing Risk (5% weight)</h4>
                    <p>PE firms with poor track records face higher refinancing costs and constraints</p>
                </div>
                </div>
            </div>
        </div>

    <script>
        // Essential Dashboard Functions
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard-data');
                if (response.ok) {
                    const data = await response.json();
                    console.log('Dashboard data loaded:', data);
                    
                    // Update companies table
                    updateCompaniesTable(data.companies);
                    
                    // Update risk distribution chart
                    updateRiskChartWithCompanies(data.companies);
                } else {
                    console.error('Failed to load dashboard data');
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Update companies table
        function updateCompaniesTable(companies) {
            console.log('updateCompaniesTable called with companies:', companies);
            const tbody = document.querySelector('#companiesTableBody');
            console.log('Table body element found:', tbody);
            if (!tbody) {
                console.error('Companies table body not found');
                return;
            }
            
            tbody.innerHTML = '';
            console.log('Table body cleared, adding companies...');
            
            companies.forEach(company => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><a href="#" onclick="viewCompanyDetails('${company.name}')" class="company-link">${company.name}</a></td>
                    <td><span class="rds-score ${getRdsScoreClass(company.current_rds_score || company.rds_score)}">${(company.current_rds_score || company.rds_score).toFixed(1)}</span></td>
                    <td><span class="risk-level ${company.risk_level.toLowerCase()}">${company.risk_level}</span></td>
                    <td>${company.recommended_action}</td>
                    <td>${company.default_timeline}</td>
                    <td>${company.leverage_risk || 0}/20</td>
                    <td>${company.interest_coverage_risk || 0}/15</td>
                    <td>${company.liquidity_risk || 0}/10</td>
                    <td>${company.cds_market_risk || 0}/10</td>
                    <td>${company.dividend_risk || 0}/15</td>
                    <td>${company.floating_debt_risk || 0}/5</td>
                    <td>${company.rating_action_risk || 0}/5</td>
                    <td>${company.cash_flow_risk || 0}/10</td>
                    <td>${company.refinancing_risk || 0}/5</td>
                    <td>${company.sponsor_profile_risk || 0}/5</td>
                    <td><button onclick="viewCompanyDetails('${company.name}')" class="btn btn-primary">View Details</button></td>
                `;
                tbody.appendChild(row);
            });
            console.log('All companies added to table. Total rows:', tbody.children.length);
        }

        // Get RDS score class for styling
        function getRdsScoreClass(score) {
            if (score < 20) return 'low';
            if (score < 40) return 'medium';
            if (score < 70) return 'high';
            return 'critical';
        }

        // View company details
        async function viewCompanyDetails(companyName) {
            try {
                console.log('Loading company details for:', companyName);
                const response = await fetch(`/api/company-details/${encodeURIComponent(companyName)}`);
                if (response.ok) {
                    const data = await response.json();
                    console.log('Full API response:', data);
                    
                    if (data.success && data.company) {
                        const company = data.company;
                        console.log('Company data received:', company);
                        
                        // Create full-page liquid glass modal
                        const modalHtml = `
                            <div id="company-modal" class="full-page-modal">
                                <div class="modal-backdrop"></div>
                                <div class="modal-content-full">
                                    <div class="modal-header-full">
                                        <h2 class="modal-title">${company.name} - Comprehensive Analysis</h2>
                                        <button onclick="closeModal()" class="close-btn-full">&times;</button>
    </div>
                                    <div class="modal-body-full">
                                        <div class="company-overview">
                                            <div class="overview-grid">
                                                <div class="overview-item">
                                                    <h3>Current RDS Score</h3>
                                                    <div class="rds-score-large ${getRdsScoreClass(company.current_rds_score || company.rds_score)}">
                                                        ${(company.current_rds_score || company.rds_score).toFixed(1)}
                                                    </div>
                                                </div>
                                                <div class="overview-item">
                                                    <h3>Risk Level</h3>
                                                    <div class="risk-level-large ${company.risk_level.toLowerCase()}">
                                                        ${company.risk_level}
                                                    </div>
                                                </div>
                                                <div class="overview-item">
                                                    <h3>Recommended Action</h3>
                                                    <div class="action-large ${company.recommended_action.toLowerCase()}">
                                                        ${company.recommended_action}
                                                    </div>
                                                </div>
                                                <div class="overview-item">
                                                    <h3>Default Timeline</h3>
                                                    <div class="timeline-large">
                                                        ${company.default_timeline}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="analysis-sections">
                                            <div class="analysis-section">
                                                <h3>RDS Criteria Breakdown</h3>
                                                <div class="criteria-grid">
                                                    <div class="criterion">
                                                        <span class="criterion-name">Leverage Risk</span>
                                                        <span class="criterion-score">${company.leverage_risk || 0}/20</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Interest Coverage Risk</span>
                                                        <span class="criterion-score">${company.interest_coverage_risk || 0}/15</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Liquidity Risk</span>
                                                        <span class="criterion-score">${company.liquidity_risk || 0}/10</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">CDS Market Risk</span>
                                                        <span class="criterion-score">${company.cds_market_risk || 0}/10</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Dividend Risk</span>
                                                        <span class="criterion-score">${company.dividend_risk || 0}/15</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Floating Debt Risk</span>
                                                        <span class="criterion-score">${company.floating_debt_risk || 0}/5</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Rating Action Risk</span>
                                                        <span class="criterion-score">${company.rating_action_risk || 0}/5</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Cash Flow Risk</span>
                                                        <span class="criterion-score">${company.cash_flow_risk || 0}/10</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Refinancing Risk</span>
                                                        <span class="criterion-score">${company.refinancing_risk || 0}/5</span>
                                                    </div>
                                                    <div class="criterion">
                                                        <span class="criterion-name">Sponsor Profile Risk</span>
                                                        <span class="criterion-score">${company.sponsor_profile_risk || 0}/5</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Remove any existing modal
                        const existingModal = document.getElementById('company-modal');
                        if (existingModal) {
                            existingModal.remove();
                        }
                        
                        // Add the new modal
                        document.body.insertAdjacentHTML('beforeend', modalHtml);
                        console.log('Full-page liquid glass modal added to DOM');
                    } else {
                        console.error('Invalid response structure:', data);
                        console.log('Invalid company data received - check API response');
                    }
                } else {
                    console.error('API response not ok:', response.status);
                    console.log('API request failed - check server logs');
                }
            } catch (error) {
                console.error('Error viewing company details:', error);
                console.log('Network or parsing error occurred');
            }
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('company-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Function to update risk distribution chart with company data
        function updateRiskChartWithCompanies(companies) {
            console.log('updateRiskChartWithCompanies: Called with companies:', companies);
            
            if (!companies || companies.length === 0) {
                console.log('updateRiskChartWithCompanies: No companies, showing empty state');
                return;
            }
            
            // Calculate risk distribution
            const riskDistribution = [0, 0, 0, 0]; // Low, Medium, High, Critical
            companies.forEach(company => {
                const score = company.current_rds_score || company.rds_score || 0;
                console.log(`Company ${company.name}: score ${score}`);
                if (score < 20) {
                    riskDistribution[0] += 1; // Low
                } else if (score < 40) {
                    riskDistribution[1] += 1; // Medium
                } else if (score < 70) {
                    riskDistribution[2] += 1; // High
                } else {
                    riskDistribution[3] += 1; // Critical
                }
            });

            console.log('updateRiskChartWithCompanies: Risk distribution calculated:', riskDistribution);
            
            // Update the chart
            updateRiskChart(riskDistribution);
        }

        // Function to update the risk distribution chart
        function updateRiskChart(riskDistribution) {
            console.log('updateRiskChart called with data:', riskDistribution);
            
            let ctx = document.getElementById('riskDistributionChart');
            console.log('Canvas element found:', ctx);
            
            if (!ctx) {
                console.error('Risk distribution chart canvas not found');
                return;
            }
            
            ctx = ctx.getContext('2d');
            console.log('Canvas context created:', ctx);

            // Destroy existing chart if it exists
            if (window.riskChart) {
                window.riskChart.destroy();
            }

            // Create new chart
            console.log('Creating new Chart with context:', ctx, 'and data:', riskDistribution);
            window.riskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk (0-19)', 'Medium Risk (20-39)', 'High Risk (40-69)', 'Critical Risk (70-100)'],
                    datasets: [{
                        data: riskDistribution,
                        backgroundColor: [
                            '#2ecc71', // Green for low risk
                            '#f1c40f', // Yellow for medium risk
                            '#e67e22', // Orange for high risk
                            '#e74c3c'  // Red for critical risk
                        ],
                        borderColor: [
                            '#27ae60',
                            '#f39c12',
                            '#d35400',
                            '#c0392b'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }
                    }
                }
            });
            
            console.log('Chart created successfully:', window.riskChart);
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            console.log('loadDashboardData function exists:', typeof loadDashboardData);
            
            // Initial load of dashboard data
            loadDashboardData();
        });
    </script>
</body>
</html>
